machine:
  node:
    version: 6.9.4
dependencies:
  cache_directories:
    - ~/.composer/cache
  override:
    - "curl -sL https://deb.nodesource.com/setup_6.x | sudo -E bash -"
    - sudo apt-get install -y nodejs
    - composer install --no-interaction --optimize-autoloader
    - npm install
    - node "node_modules/gulp/bin/gulp.js"
test:
  override:
    - "vendor/bin/phpunit"
    - "npm test"
deployment:
  push_to_server:
    branch: master
    commands:
      - rsync -avzp --delete --exclude-from '.rsyncignore' . circleci@138.197.148.166:/var/www/themusictank.com
