{"version":3,"sources":["globals.js","event-emitter.js","app.js","profile.js","ajax-form.js","player.js","upvote-form.js","search-form.js","notifier.js","knob.js","reviewer.js","canvas.js","vector.js","particle.js","particle-emitter.js","ajax-forms-initializer.js","player-initializer.js","reviewer-initializer.js","profile-initializer.js","search-initializer.js","upvote-forms-initializer.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC18BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["\"use strict\";\r\n\r\n/**\r\n * Globally exposed namespacing function.\r\n * @public\r\n * @param {string} namespace\r\n * @return {object} A referene to the object created\r\n */\r\nfunction namespace(namespace) {\r\n    var object = window, tokens = namespace.split(\".\"), token;\r\n\r\n    while (tokens.length > 0) {\r\n        token = tokens.shift();\r\n\r\n        if (typeof object[token] === \"undefined\") {\r\n            object[token] = {};\r\n        }\r\n\r\n        object = object[token];\r\n    }\r\n\r\n    return object;\r\n}\r\n\r\n/**\r\n * Globally exposed extending function.\r\n * @param {object} target\r\n * @param {hash} source\r\n * @return {object}\r\n */\r\nfunction extend(target, source) {\r\n    target = target || {};\r\n    for (var prop in source) {\r\n        if (typeof source[prop] === 'object') {\r\n            target[prop] = extend(target[prop], source[prop]);\r\n        } else {\r\n            target[prop] = source[prop];\r\n        }\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * Sets up inheritance of the child object to the objects\r\n * supplied by the parents object.\r\n * @param {array} parents\r\n * @param {object} child\r\n * @param {hash} properties\r\n * @return {object} An object with inheritance\r\n */\r\nfunction inherit(parents, child, properties) {\r\n    var childPrototype = properties;\r\n\r\n    for (var i in parents) {\r\n        var parentPrototype = Object.create(parents[i].prototype);\r\n        childPrototype = extend(parentPrototype, childPrototype);\r\n    }\r\n\r\n    child.prototype = childPrototype;\r\n    child.prototype.constructor = child;\r\n\r\n    return child;\r\n}\r\n\r\n/**\r\n * Globally filters out jQuery elements matching selector\r\n * from the haystack. This expects javascript objects that\r\n * have a public \"getRootNode\" method.\r\n * @param {string} selector\r\n * @param {array} haystack\r\n * @return {array} matches\r\n */\r\nfunction filter(selector, haystack) {\r\n    var matches = [];\r\n\r\n    haystack.forEach(function (hay) {\r\n        var node = hay.getRootNode();\r\n        if (node && node.is(selector)) {\r\n            matches.push(hay);\r\n        }\r\n    });\r\n\r\n    return matches;\r\n}\r\n\r\n\r\nfunction debounce(func, threshold, execAsap) {\r\n    var timeout;\r\n\r\n    return function debounced() {\r\n        var obj = this, args = arguments;\r\n        function delayed() {\r\n            if (!execAsap)\r\n                func.apply(obj, args);\r\n            timeout = null;\r\n        };\r\n\r\n        if (timeout)\r\n            clearTimeout(timeout);\r\n        else if (execAsap)\r\n            func.apply(obj, args);\r\n\r\n        timeout = setTimeout(delayed, threshold || 100);\r\n    };\r\n}\r\n","(function (undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * @namespace Tmt.EventEmitter\r\n     * @property {array} events A collection of object events and callbacks.\r\n     */\r\n    var EventEmitter = namespace(\"Tmt\").EventEmitter = function() {\r\n        this.events = null;\r\n    };\r\n\r\n    inherit([Evemit], namespace(\"Tmt\").EventEmitter, {\r\n\r\n        /**\r\n         * Initializes the event emitter object.\r\n         * @method\r\n         * @public\r\n         */\r\n        'initialize': function () {\r\n            // Exposing the creation in a prototype method\r\n            // ensures child classes will have an instantiated value\r\n            // even if they don't go through the constructor.\r\n            this.events = {};\r\n        }\r\n    });\r\n\r\n}());\r\n","(function (undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * The global wrapper for the application instance.\r\n     * @namespace Tmt.App\r\n     * @extends {Tmt.EventEmitter}\r\n     * @property {Tmt.Models.Profile} profile - An active session profile\r\n     * @property {Array} initializers - An array of Tmt.Initializers object.\r\n     */\r\n    var App = namespace(\"Tmt\").App = function () {\r\n        this.profile = null;\r\n        this.initializers = [];\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], App, {\r\n\r\n        /**\r\n         * Boots the application instance\r\n         * @public\r\n         * @method\r\n         */\r\n        boot: function () {\r\n            this.profile = new Tmt.Models.Profile();\r\n            prepareInitializers.call(this);\r\n            this.emit(\"ready\", this);\r\n        },\r\n\r\n        /**\r\n         * Assigns session data from PHP to this javascript\r\n         * session instance.\r\n         * @method\r\n         * @public\r\n         */\r\n        setData: function (data) {\r\n            if (data.profile) {\r\n                this.profile.setData(data.profile);\r\n                this.emit('profileFirstPopulated', this, this.profile);\r\n            }\r\n\r\n            this.emit('configured', this);\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Loads all initializer objects that it can dynamically find\r\n     * in the Tmt.Initializers namespace and then builds them.\r\n     * @method\r\n     * @private\r\n     */\r\n    function prepareInitializers() {\r\n        // Create an intance of each initializer.\r\n        for (var type in Tmt.Initializers) {\r\n            this.initializers[type] = new Tmt.Initializers[type]();\r\n        }\r\n\r\n        // Run the initialization. This is done in two steps because\r\n        // initializers may depend on one another.\r\n        for (var type in this.initializers) {\r\n            this.initializers[type].build(this);\r\n        }\r\n    }\r\n\r\n}());\r\n","(function (undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * The Profile object is the frontend equivalent of the\r\n     * backend Profile model.\r\n     * @namespace Tmt.Models.Profile\r\n     * @property {array} albumUpvotes\r\n     * @property {array} trackUpvotes\r\n     * @property {array} activities\r\n     */\r\n    var Profile = namespace(\"Tmt.Models\").Profile = function () {\r\n        this.notifications = [];\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], Profile, {\r\n\r\n        /**\r\n         * Applies backend session data to the object.\r\n         * @param {hash} userData\r\n         * @public\r\n         * @method\r\n         * @fires Profile#upvoteSet\r\n         */\r\n        setData: function (userData) {\r\n            this.username = userData.username;\r\n            this.email = userData.email;\r\n            this.slug = userData.slug;\r\n            this.name = userData.name;\r\n            this.id = userData.id;\r\n            this.emit(\"dataChange\", this);\r\n\r\n           // this.albumUpvotes = indexUpvotes(\"albumUpvotes\", userData);\r\n            this.albumUpvotes = userData.albumUpvotes;\r\n            this.emit(\"upvoteChange\", \"album\", this.albumUpvotes);\r\n\r\n            // this.trackUpvotes = indexUpvotes(\"trackUpvotes\", userData);\r\n            this.trackUpvotes = userData.trackUpvotes;\r\n            this.emit(\"upvoteChange\", \"track\",this.trackUpvotes);\r\n        },\r\n\r\n        /**\r\n         * Adds a new vote value to the current profile\r\n         * @param {string} type One of track or album\r\n         * @param {string} key The {type}'s id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        addUpvote: function (type, key, value) {\r\n            if (type == \"album\") {\r\n                return this.addAlbumUpvote(key, value);\r\n            } else if (type == \"track\") {\r\n                return this.addTrackUpvote(key, value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Add a new album vote\r\n         * @param {string} key album id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        addAlbumUpvote: function (key, value) {\r\n            this.albumUpvotes[key] = value;\r\n            this.emit(\"upvoteUpdate\", \"album\", this.albumUpvotes);\r\n        },\r\n\r\n        /**\r\n         * Add a new track vote\r\n         * @param {string} key track id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        addTrackUpvote: function (key, value) {\r\n            this.trackUpvotes[key] = value;\r\n            this.emit(\"upvoteUpdate\", \"track\", this.trackUpvotes);\r\n        },\r\n\r\n        /**\r\n         * Removes an existing vote value to the current profile\r\n         * @param {string} type One of track or album\r\n         * @param {string} key The {type}'s id\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        removeUpvote: function (type, key) {\r\n            if (type == \"album\") {\r\n                return this.removeAlbumUpvote(key, value);\r\n            } else if (type == \"track\") {\r\n                return this.removeTrackUpvote(key, value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Removes an existing album vote\r\n         * @param {string} key album id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        removeAlbumUpvote: function (type, key) {\r\n            delete this.albumUpvotes[key];\r\n            this.emit(\"upvoteUpdate\", \"album\", this.upvotes);\r\n        },\r\n\r\n        /**\r\n         * Removes an existing track vote\r\n         * @param {string} key track id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        removeTrackUpvote: function (type, key) {\r\n            delete this.trackUpvotes[key];\r\n            this.emit(\"upvoteUpdate\", \"track\", this.upvotes);\r\n        },\r\n\r\n        /**\r\n         * Adds a user activity notification (viewed or not)\r\n         * @param {hash} notification\r\n         * @fires Profile#notification\r\n         * @public\r\n         * @method\r\n         */\r\n        addNotification : function (notification) {\r\n            this.notifications.push(notification);\r\n\r\n            if (this.notifications.length > 10) {\r\n                this.notifications.length = 10;\r\n            }\r\n\r\n            this.emit(\"notification\", notification);\r\n        },\r\n\r\n        getVoteByObjectId : function (type, objectId) {\r\n            var match = null;\r\n\r\n            if (type == \"track\") {\r\n                match = this.trackUpvotes[objectId];\r\n            } else if (type == \"album\") {\r\n                match = this.albumUpvotes[objectId];\r\n            }\r\n\r\n            if (match) {\r\n                return match.vote;\r\n            }\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Data saved in the database is not easily serachable\r\n     * in javascript. This method bridges the two.\r\n     * @param {string} key one of track or album\r\n     * @param {hash} data values as stored in the BD\r\n     * @return {hash} A javascript-oriented indexed object\r\n     * @private\r\n     * @method\r\n     */\r\n    // function indexUpvotes(key, data) {\r\n    //     var indexed = [];\r\n    //     if (data && data[key]) {\r\n    //         for (var i in data[key]) {\r\n    //             var id = data[key][i].id,\r\n    //                 value = data[key][i].vote;\r\n\r\n    //             indexed[id] = value;\r\n    //         }\r\n    //     }\r\n    //     return indexed;\r\n    // }\r\n\r\n}());\r\n","(function () {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * A form object that can be captured using ajax.\r\n     * @param {jQuery} el\r\n     */\r\n    var AjaxForm = namespace(\"Tmt.Components\").AjaxForm = function (el) {\r\n        this.rootNode = el;\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], AjaxForm, {\r\n        initialize: function () {\r\n            Tmt.EventEmitter.prototype.initialize.call(this);\r\n            addEvents.call(this);\r\n        },\r\n\r\n        getRootNode: function () {\r\n            return this.rootNode;\r\n        }\r\n    });\r\n\r\n\r\n    function addEvents() {\r\n        this.rootNode.on(\"submit\", onSubmit.bind(this));\r\n        this.emit(\"bound\", this);\r\n    }\r\n\r\n    function onSubmit(event) {\r\n        event.preventDefault();\r\n\r\n        this.rootNode.addClass(\"working\");\r\n        this.emit(\"beforeSubmit\", this, event);\r\n\r\n        $.ajax({\r\n            url: this.rootNode.attr(\"action\"),\r\n            data: new FormData(this.rootNode.get(0)),\r\n            cache: false,\r\n            processData: false,\r\n            contentType: false,\r\n            type: this.rootNode.attr('method'),\r\n            success: onSubmitSuccess.bind(this)\r\n        });\r\n\r\n        this.emit(\"submit\", this);\r\n    }\r\n\r\n    function onSubmitSuccess(response) {\r\n        this.rootNode.removeClass(\"working\");\r\n        this.emit(\"submitSuccess\", response, this);\r\n    }\r\n\r\n}());\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var Player = namespace(\"Tmt.Components\").Player = function (element) {\r\n        this.rootNode = element;\r\n        this.ready = false;\r\n        this.embed = null;\r\n        this.ytPlayer = null;\r\n        this.playing = false;\r\n        this.canSkip = true;\r\n        this.range = null;\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], Player, {\r\n        'isReady' : function() {\r\n            return this.ready;\r\n        },\r\n\r\n        'isPlaying' : function() {\r\n            return this.playing;\r\n        },\r\n\r\n        'getStreamer' : function() {\r\n            return this.ytPlayer;\r\n        },\r\n\r\n        'render': function () {\r\n            this.hasVideoId() ?\r\n                embedVideo.call(this) :\r\n                queryForKey.call(this);\r\n        },\r\n\r\n        'getEmbedId': function () {\r\n            if (this.hasVideoId()) {\r\n                return \"tmt_player_\" + this.getVideoId();\r\n            }\r\n        },\r\n\r\n        'getVideoId': function () {\r\n            return this.rootNode.data(\"song-vid\");\r\n        },\r\n\r\n        'setVideoId': function (id) {\r\n            this.rootNode.data(\"song-vid\", id);\r\n        },\r\n\r\n        'hasVideoId': function () {\r\n            return this.getVideoId() != \"\";\r\n        },\r\n\r\n        'getSongSlug': function () {\r\n            return this.rootNode.data(\"song-slug\");\r\n        }\r\n    });\r\n\r\n    function queryForKey() {\r\n        $.getJSON('/ajax/ytkey/' + this.getSongSlug(), onYtKeyReceived.bind(this));\r\n    }\r\n\r\n    function onYtKeyReceived(response) {\r\n        if (response.youtubekey.length === 11) {\r\n            this.setVideoId(response.youtubekey);\r\n            embedVideo.call(this);\r\n        }\r\n    }\r\n\r\n    function embedVideo() {\r\n        var id = this.getEmbedId();\r\n        var iframeHtml =\r\n            '<iframe id=\"' + id + '\" scrolling=\"no\" marginwidth=\"0\" ' +\r\n            'marginheight=\"0\" frameborder=\"0\" src=\"//www.youtube.com/embed/' +\r\n            this.getVideoId() + '?enablejsapi=1&amp;iv_load_policy=3&amp;' +\r\n            'playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0' +\r\n            '&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;' +\r\n            'autoplay=0&amp;loop=0&amp;origin=' + window.location.origin + '\"></iframe>'\r\n\r\n        this.rootNode.append(iframeHtml);\r\n        this.embed = $(\"#\" + id);\r\n\r\n        this.ytPlayer = new YT.Player(id);\r\n        this.ytPlayer.addEventListener('onReady', onPlayerReady.bind(this));\r\n        this.ytPlayer.addEventListener('onStateChange', onPlayerStateChange.bind(this));\r\n\r\n        this.ready = true;\r\n        this.emit(\"embeded\", this);\r\n    }\r\n\r\n    function onPlayerStateChange(newState) {\r\n        /*\r\n        -1 (unstarted)\r\n        0 (ended)\r\n        1 (playing)\r\n        2 (paused)\r\n        3 (buffering)\r\n        5 (video queued) */\r\n        var controlButton = this.rootNode.find('.play');\r\n\r\n        if (newState.data === 1) {\r\n            controlButton.removeClass(\"fa-play\");\r\n            controlButton.addClass(\"fa-pause\");\r\n\r\n            this.playing = true;\r\n            this.emit(\"play\");\r\n            onPlayerTick.call(this);\r\n        }\r\n        else if (newState.data === 2) {\r\n            controlButton.removeClass(\"fa-pause\");\r\n            controlButton.addClass(\"fa-play\");\r\n\r\n            this.playing = false;\r\n            this.emit(\"stop\");\r\n        }\r\n    }\r\n\r\n    function onProgressClick(e) {\r\n        if (this.playing) {\r\n            var progressBar = this.rootNode.find(\".progress-wrap .progress\"),\r\n                offset = progressBar.offset(),\r\n                relX = e.pageX - offset.left,\r\n                pctLocation = relX / progressBar.width();\r\n            this.ytPlayer.seekTo(pctLocation * this.ytPlayer.getDuration(), true);\r\n        }\r\n    };\r\n\r\n    function onPlayBtnClick(e) {\r\n        // Ranges wil be back shortly\r\n        this.playingRange = null;\r\n\r\n        (this.ytPlayer.getPlayerState() != 1) ?\r\n            this.ytPlayer.playVideo() :\r\n            this.ytPlayer.pauseVideo();\r\n    }\r\n\r\n\r\n    function onPlayerReady(event) {\r\n        this.rootNode.find(\".duration\").html(toReadableTime(this.ytPlayer.getDuration()));\r\n        this.rootNode.find(\".position\").html(toReadableTime(0));\r\n        this.rootNode.find(\".progress-wrap .progress\").click(onProgressClick.bind(this));\r\n\r\n        var playBtn = this.rootNode.find('.play');\r\n        playBtn.removeClass(\"fa-stop\");\r\n        playBtn.addClass(\"fa-play\");\r\n        playBtn.click(onPlayBtnClick.bind(this));\r\n\r\n        // Ranges wil be back shortly\r\n        // $(\"*[data-from]\").click(function () {\r\n        //     var el = $(this);\r\n        //     tmt.playingRange = [parseInt(el.attr(\"data-from\"), 10), parseInt(el.attr(\"data-to\"), 10)];\r\n        //     (player.getPlayerState() != 1) ? player.playVideo() : player.pauseVideo();\r\n        //     player.seekTo(tmt.playingRange[0], true);\r\n        // });\r\n    };\r\n\r\n    function onPlayerTick() {\r\n        var currentTime = this.ytPlayer.getCurrentTime(),\r\n            durationTime = this.ytPlayer.getDuration(),\r\n            currentPositionPct = (currentTime / durationTime) * 100;\r\n\r\n        this.rootNode.find('.position').html(toReadableTime(currentTime));\r\n\r\n        this.rootNode.find('.cursor').css(\"left\", currentPositionPct + \"%\");\r\n        this.rootNode.find('.progress .loaded-bar').css(\"width\", (this.ytPlayer.getVideoLoadedFraction() * 100) + \"%\");\r\n        this.rootNode.find('.progress .playing-bar').css(\"width\", currentPositionPct + \"%\");\r\n        this.rootNode.find('.progress .playing-bar').attr(\"aria-valuenow\", currentTime);\r\n\r\n        if (this.playing) {\r\n            // if (tmt.playingRange) {\r\n\r\n            //     if (currentTime >= tmt.playingRange[1]) {\r\n            //         tmt.playingRange = null;\r\n            //         player.pauseVideo();\r\n            //     }\r\n            //     else if (currentTime <= tmt.playingRange[0]) {\r\n            //         player.seekTo(tmt.playingRange[0], true);\r\n            //     }\r\n            // }\r\n            setTimeout(onPlayerTick.bind(this), 250);\r\n        }\r\n    }\r\n\r\n    function toReadableTime(seconds) {\r\n        var time = new Date(1000 * seconds),\r\n            mins = (\"0\" + time.getMinutes()).slice(-2),\r\n            secs = (\"0\" + time.getSeconds()).slice(-2);\r\n\r\n        return mins + \":\" + secs;\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n\r\n    var UpvoteForm = namespace(\"Tmt.Components\").UpvoteForm = function (ajaxFormObj) {\r\n        this.ajaxForm = ajaxFormObj;\r\n        this.rootNode = ajaxFormObj.getRootNode();\r\n        this.enabled = false;\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], UpvoteForm, {\r\n\r\n        \"initialize\": function () {\r\n            Tmt.EventEmitter.prototype.initialize.call(this);\r\n\r\n            addEvents.call(this);\r\n            resetButtons.call(this);\r\n\r\n            this.rootNode.addClass('initialized');\r\n        },\r\n\r\n        \"getType\": function () {\r\n            return this.rootNode.data(\"upvote-type\");\r\n        },\r\n\r\n        \"getObjectId\": function () {\r\n            return this.rootNode.data(\"upvote-object-id\");\r\n        },\r\n\r\n        \"setObjectId\": function (id) {\r\n            return this.rootNode.data(\"upvote-object-id\", id);\r\n        },\r\n\r\n        \"isTrack\": function () {\r\n            return this.getType() == \"track\";\r\n        },\r\n\r\n        \"isAlbum\": function () {\r\n            return this.getType() == \"album\";\r\n        },\r\n\r\n        \"setValue\": function (value) {\r\n            this.rootNode.removeClass(\"liked disliked\");\r\n            this.rootNode.find(\"input[name=vote]\").val(value);\r\n\r\n            if (value == 1) {\r\n                this.rootNode.addClass(\"liked\");\r\n                enableButton(this.rootNode.find('button.up'));\r\n            } else if (value == 2) {\r\n                this.rootNode.addClass(\"disliked\");\r\n                this.rootNode.find('button.down').html('<i class=\"fa fa-thumbs-down\" aria-hidden=\"true\">');\r\n            } else {\r\n                resetButtons.call(this);\r\n            }\r\n\r\n            this.emit('valueChange', value, this);\r\n        },\r\n\r\n        \"getValue\": function () {\r\n            return this.rootNode.find(\"input[name=vote]\").val();\r\n        },\r\n\r\n        \"lock\": function () {\r\n            this.enabled = false;\r\n            this.rootNode.find(\"button\").attr(\"disabled\", \"disabled\");\r\n        },\r\n\r\n        \"unlock\": function () {\r\n            this.enabled = true;\r\n            this.rootNode.find(\"button\").removeAttr(\"disabled\");\r\n        }\r\n    });\r\n\r\n    function addEvents() {\r\n        this.rootNode.find(\"button\").click(onButtonClick.bind(this));\r\n        this.ajaxForm.on('submitSuccess', onSubmitSuccess.bind(this));\r\n    };\r\n\r\n    function resetButtons() {\r\n        this.rootNode.find('button.up').html('<i class=\"fa fa-thumbs-o-up\" aria-hidden=\"true\">');\r\n        this.rootNode.find('button.down').html('<i class=\"fa fa-thumbs-o-down\" aria-hidden=\"true\">');\r\n    }\r\n\r\n    function enableButton(button) {\r\n        if (button.hasClass(\"up\")) {\r\n            button.html('<i class=\"fa fa-thumbs-up\" aria-hidden=\"true\">');\r\n        }\r\n        if (button.hasClass(\"down\")) {\r\n            button.html('<i class=\"fa fa-thumbs-down\" aria-hidden=\"true\">');\r\n        }\r\n    }\r\n\r\n    function onButtonClick(evt) {\r\n        if (!this.enabled) {\r\n            return;\r\n        }\r\n\r\n        var $el = $(evt.target),\r\n            button = $el.parents('button'),\r\n            clickedValue = button.val();\r\n\r\n        if (clickedValue != this.getValue()) {\r\n            this.setValue(clickedValue);\r\n        } else {\r\n            // twice the same value means the user wants to cancel\r\n            this.setValue(-1);\r\n        }\r\n\r\n        this.lock();\r\n        this.rootNode.submit();\r\n    }\r\n\r\n    function onSubmitSuccess(response, ajaxForm) {\r\n        if (response && response.vote) {\r\n            this.setObjectId(response.id);\r\n            this.setValue(response.vote);\r\n        }\r\n\r\n        this.unlock();\r\n    }\r\n\r\n})(jQuery);\r\n","\r\n(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var SearchForm = namespace(\"Tmt.Components\").SearchForm = function () {\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], SearchForm, {\r\n\r\n        \"initialize\": function () {\r\n            Tmt.EventEmitter.prototype.initialize.call(this);\r\n\r\n            // search box\r\n            var artistsSearch = new Bloodhound({\r\n                name: 'artists',\r\n                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('artist'),\r\n                queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n                remote: {\r\n                    url: '/ajax/artistSearch/?q=%QUERY',\r\n                    wildcard: '%QUERY'\r\n                }\r\n            }),\r\n                albumsSearch = new Bloodhound({\r\n                    name: 'albums',\r\n                    datumTokenizer: Bloodhound.tokenizers.obj.whitespace('album'),\r\n                    queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n                    remote: {\r\n                        url: '/ajax/albumSearch/?q=%QUERY',\r\n                        wildcard: '%QUERY'\r\n                    }\r\n                }),\r\n                tracksSearch = new Bloodhound({\r\n                    name: 'tracks',\r\n                    datumTokenizer: Bloodhound.tokenizers.obj.whitespace('track'),\r\n                    queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n                    remote: {\r\n                        url: '/ajax/trackSearch/?q=%QUERY',\r\n                        wildcard: '%QUERY'\r\n                    }\r\n                }),\r\n                searchBox = $('.typeahead');\r\n\r\n\r\n            // Listens for when Typeahead a selected a value.\r\n            function typeahead_onSelected(e, data, section) {\r\n                e.preventDefault();\r\n                document.location = $('.tt-cursor a:nth-child(1)').attr('href');\r\n            }\r\n\r\n            artistsSearch.initialize();\r\n            albumsSearch.initialize();\r\n            tracksSearch.initialize();\r\n\r\n            searchBox.on(\"typeahead:selected\", typeahead_onSelected);\r\n\r\n            searchBox.typeahead(\r\n                { minLength: 3, highlight: true, cache: true },\r\n                [\r\n                    {\r\n                        name: 'artists',\r\n                        display: 'artist',\r\n                        source: artistsSearch,\r\n                        cache: true,\r\n                        templates: {\r\n                            header: '<h3>Artists</h3>',\r\n                            empty: '<h3>Artists</h3><p class=\"empty-message\">Could not find matching artists.</p>',\r\n                            suggestion: function (data) { return ['<p><a href=\"/artists/' + data.slug + '/\">' + data.name + '</a></p>'].join(\"\"); }\r\n                        }\r\n                    },\r\n                    {\r\n                        name: 'albums',\r\n                        display: 'album',\r\n                        source: albumsSearch,\r\n                        cache: true,\r\n                        templates: {\r\n                            header: '<h3>Albums</h3>',\r\n                            empty: '<h3>Albums</h3><p class=\"empty-message\">Could not find matching albums.</p>',\r\n                            suggestion: function (data) { return ['<p><a href=\"/albums/' + data.slug + '/\">' + data.name + '</a> by <a href=\"/artists/' + data.artist.slug + '/\">' + data.artist.name + '</a></p>'].join(\"\"); }\r\n                        }\r\n                    },\r\n                    {\r\n                        name: 'tracks',\r\n                        display: 'track',\r\n                        source: tracksSearch,\r\n                        cache: true,\r\n                        templates: {\r\n                            header: '<h3>Tracks</h3>',\r\n                            empty: '<h3>Tracks</h3><p class=\"empty-message\">Could not find matching tracks.</p>',\r\n                            suggestion: function (data) { return ['<p><a href=\"/tracks/' + data.slug + '/\">' + data.name + '</a> by <a href=\"/artists/' + data.artist.slug + '/\">' + data.artist.name + '</a></p>'].join(\"\"); }\r\n                        }\r\n                    }\r\n                ]\r\n            );\r\n\r\n        }\r\n    });\r\n\r\n\r\n})(jQuery);\r\n","(function () {\r\n\r\n    \"use strict\";\r\n\r\n    var rootNode,\r\n        profile,\r\n        // sound,\r\n        notifications = [];\r\n\r\n    /**\r\n     * A user notifier control.\r\n     * @param {jQuery} el\r\n     */\r\n    var Notifier = namespace(\"Tmt.Components\").Notifier = function (el, profileObj) {\r\n        rootNode = el;\r\n        profile = profileObj;\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], Notifier, {\r\n        'initialize': function () {\r\n            Tmt.EventEmitter.prototype.initialize.call(this);\r\n\r\n            addEvents.call(this);\r\n            render.call(this);\r\n\r\n            addSound();\r\n        },\r\n\r\n        'hasNotifications': function () {\r\n            return notifications.length > 0;\r\n        },\r\n\r\n        'getAlertCount': function () {\r\n            var alertCount = 0;\r\n            for (var i = 0; i < notifications.length; i++) {\r\n                if (notifications[i]['must_notify'] > 0) {\r\n                    alertCount++;\r\n                }\r\n            }\r\n            return alertCount;\r\n        }\r\n    });\r\n\r\n    function render() {\r\n        this.hasNotifications() ?\r\n            rootNode.find('li.no-notices').hide() :\r\n            rootNode.find('li.no-notices').show();\r\n\r\n\r\n        var alertCount = this.getAlertCount(),\r\n            notice = rootNode.find('em');\r\n\r\n        notice.html(alertCount);\r\n        alertCount > 0 ?\r\n            notice.show() :\r\n            notice.hide();\r\n    }\r\n\r\n    function addEvents() {\r\n        rootNode.find('ul').click(onListClick.bind(this));\r\n        rootNode.find('button').click(onClearClick.bind(this));\r\n        profile.on(\"notification\", onNewNotification.bind(this));\r\n    };\r\n\r\n    function addSound() {\r\n        // We don't really have a way to telling if the notifications are actually new,\r\n        // or if a user navigated to another page while having unread notifications from the previous page.\r\n        // There are likely other similar cases where it wouldn't make sense to play a sound.\r\n        // Once we figure how to do it well, lets enable it.\r\n\r\n        // credit : https://notificationsounds.com/funny/surprise-on-a-spring-496\r\n        // sound = new Howl({ src: ['http://static.themusictank.com/assets/surprise-on-a-spring.mp3'] });\r\n    }\r\n\r\n    function onListClick(evt) {\r\n        if (evt.target.tagName.toLowerCase() == \"a\") {\r\n            evt.preventDefault();\r\n            var target = $(evt.target);\r\n\r\n            for (var i = 0; i < notifications.length; i++) {\r\n                if (notifications[i]['id'] == target.data(\"id\")) {\r\n                    notifications[i]['must_notify'] = 0;\r\n                    target.parent().removeClass(\"new\");\r\n                    target.parent().addClass(\"old\");\r\n                    break;\r\n                }\r\n            }\r\n\r\n            render.call(this);\r\n            this.emit('notificationRead', [target.data(\"id\")], target.href);\r\n        }\r\n    }\r\n\r\n    function onClearClick(evt) {\r\n        var ids = collectNewActivityIds.call(this);\r\n        if (ids.length > 0) {\r\n            for (var i = 0; i < notifications.length; i++) {\r\n                notifications[i]['must_notify'] = 0;\r\n            }\r\n            rootNode.find('li').removeClass(\"new\");\r\n            rootNode.find('li').addClass(\"old\");\r\n\r\n            render.call(this);\r\n            this.emit('notificationRead', ids);\r\n        }\r\n    }\r\n\r\n    function onNewNotification(notification) {\r\n\r\n        var label = notification['association_summary'] ? notification['association_summary'] : \"Notification\";\r\n\r\n        if (notification['associated_object_type'] === \"profile\") {\r\n            label = '<a data-id=\"' + notification['id'] + '\" href=\"/tankers/' + notification['associated_object']['slug'] + '\">' + notification['associated_object']['name'] + ' is now following you.</a>';\r\n        }\r\n\r\n        rootNode.find('ul').append('<li class=\"' + (notification['must_notify'] > 0 ? 'new' : 'old') + '\">' + label + '</li>');\r\n\r\n        notifications.push(notification);\r\n        if (notifications > 5) {\r\n            notifications = 5;\r\n        }\r\n\r\n        // if (notification['must_notify']) {\r\n        //     this.sound.play();\r\n        // }\r\n\r\n        render.call(this);\r\n    }\r\n\r\n    function collectNewActivityIds() {\r\n        var ids = [];\r\n        for (var i = 0; i < notifications.length; i++) {\r\n            if (notifications[i]['must_notify'] > 0) {\r\n                ids.push(notifications[i]['id']);\r\n            }\r\n        }\r\n        return ids;\r\n    }\r\n\r\n}());\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var Knob = namespace(\"Tmt.Components.Reviewer\").Knob = function (element) {\r\n        this.track = element;\r\n        this.knob = element.find('b');\r\n\r\n        this.enabled = false;\r\n        this.working = false;\r\n        this.position = null;\r\n        this.trackHeight = null;\r\n        this.draggable = null;\r\n        this.nudged = false;\r\n\r\n        this.value = 0;\r\n\r\n        addEvents.call(this);\r\n        saveCurrentPosition.call(this);\r\n    };\r\n\r\n    inherit([], Knob, {\r\n        enable: function () {\r\n            this.track.removeClass(\"disabled\");\r\n            this.track.addClass(\"enabled\");\r\n\r\n            this.draggable.enable();\r\n            this.enabled = true;\r\n        },\r\n\r\n        disable: function () {\r\n            this.track.addClass(\"disabled\");\r\n            this.track.removeClass(\"enabled\");\r\n\r\n            this.draggable.disable();\r\n            this.enabled = false;\r\n        },\r\n\r\n        setValue: function (value) {\r\n            this.value = value;\r\n\r\n            if (!this.working) {\r\n                var topPosition = this.trackHeight * (1 - value);\r\n                TweenMax.set(this.knob.get(0), { css: { y:  topPosition } });\r\n                this.draggable.update();\r\n            }\r\n        },\r\n\r\n        getValue: function () {\r\n            if (this.working) {\r\n                var value = 1 - (this.draggable.y / this.trackHeight);\r\n            } else {\r\n                var value = this.value;\r\n            }\r\n            \r\n            // Ensure we don't break boundries\r\n            if (value > 1)  {\r\n                return 1;\r\n            } else if (value < 0) {\r\n                return 0;\r\n            }\r\n\r\n            return value;\r\n        },\r\n\r\n        isWorking : function() {\r\n            return this.working;\r\n        },\r\n\r\n        isEnabled : function() {\r\n            return this.enabled;\r\n        },\r\n\r\n        stopCurrentDrag : function() {\r\n            this.draggable.disable();\r\n            this.draggable.enable();\r\n        },\r\n\r\n        nudge : function() {\r\n            this.nudged = true;\r\n            this.track.css({\r\n                'margin-top' : (Math.random() <= 0.5 ?  2 : -2) + \"px\",\r\n                'margin-left' : (Math.random() <= 0.5 ?  2 : -2) + \"px\"\r\n            });\r\n        },\r\n\r\n        center : function() {\r\n            if (this.nudged) {\r\n                this.track.css({\r\n                    'margin-top' : null,\r\n                    'margin-left' : null\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    function saveCurrentPosition() {\r\n        this.position = this.track.position();\r\n        this.trackHeight = this.track.innerHeight() - this.knob.outerHeight();\r\n    }\r\n\r\n    function addEvents() {\r\n        this.draggable = Draggable.create(this.knob.get(0), {\r\n            type: \"y\",\r\n            bounds: this.track.get(0),\r\n            onDragStart: onDragStart.bind(this),\r\n            onDragEnd: onDragEnd.bind(this),\r\n        })[0];\r\n    }\r\n\r\n    function onDragStart() {\r\n        this.working = true;\r\n    }\r\n\r\n    function onDragEnd() {\r\n        this.working = false;\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var NEUTRAL_GROOVE_POINT = 0.500,\r\n        GROOVE_DECAY = 0.0005,\r\n        FRAMERATE = 26,\r\n        SAVE_FRAMERATE = 3 / FRAMERATE * 1000,\r\n        HIGH_GROOVE_THRESHOLD = 0.98,\r\n        LOW_GROOVE_THRESHOLD = 0.02,\r\n        LENGTH_TO_SHAKE = 0.65 * FRAMERATE,\r\n        LENGTH_PER_SHAKE = 1.75 * FRAMERATE;\r\n\r\n\r\n    var Reviewer = namespace(\"Tmt.Components.Reviewer\").Reviewer = function (element, playerObj) {\r\n        this.rootNode = element;\r\n        this.player = playerObj;\r\n        this.shaking = false;\r\n\r\n        this.timers = {\r\n            highGrooveStart: null,\r\n            lowGrooveStart: null,\r\n        };\r\n        this.currentGroove = 0;\r\n        this.currentFrameId = 0;\r\n        this.drawnFrameId = null;\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], Reviewer, {\r\n\r\n        'initialize': function () {\r\n            Tmt.EventEmitter.prototype.initialize.call(this);\r\n\r\n            registerKnob.call(this);\r\n            registerCanvas.call(this);\r\n            addEvents.call(this);\r\n            setGrooveTo.call(this, NEUTRAL_GROOVE_POINT);\r\n            start.call(this);\r\n        }\r\n    });\r\n\r\n    function addEvents() {\r\n        this.player.on(\"play\", onPlay.bind(this));\r\n        this.player.on(\"stop\", onStop.bind(this));\r\n    }\r\n\r\n    function setGrooveTo(value) {\r\n        this.currentGroove = value;\r\n        this.knob.setValue(value);\r\n    }\r\n\r\n    function start() {\r\n        this.player.getStreamer().playVideo();\r\n    }\r\n\r\n    function onPlay() {\r\n        this.knob.enable();\r\n        tick.call(this);\r\n        animate.call(this);\r\n    }\r\n\r\n    function onStop() {\r\n        this.knob.disable();\r\n    }\r\n\r\n    function registerKnob() {\r\n        this.knob = new Tmt.Components.Reviewer.Knob(this.rootNode.find(\".knob-track\"));\r\n    }\r\n\r\n    function registerCanvas() {\r\n        this.canvas = new Tmt.Components.Reviewer.Canvas(this.rootNode.find(\"canvas\"));\r\n\r\n        this.canvas.addEmitter(\"positiveSpark\", this.canvas.node.width / 2, this.canvas.node.height * .15);\r\n        this.canvas.addEmitter(\"negativeSpark\", this.canvas.node.width / 2, this.canvas.node.height * .85);\r\n    }\r\n\r\n    function tick() {\r\n        if (this.player.isPlaying()) {\r\n            setFrameContext.call(this);\r\n            calculateTimelineContext.call(this);\r\n            calculateGroove.call(this);\r\n            // saveFrameBAtch\r\n\r\n            setTimeout(tick.bind(this), 1000 / FRAMERATE);\r\n        }\r\n    }\r\n\r\n    function animate() {\r\n        if (this.drawnFrameId != this.currentFrameId) {\r\n            this.drawnFrameId = this.currentFrameId;\r\n            paintFrame.call(this);\r\n            requestAnimationFrame(animate.bind(this));\r\n        }\r\n    }\r\n\r\n    function isPositive() {\r\n        return this.currentGroove > NEUTRAL_GROOVE_POINT;\r\n    }\r\n\r\n    function isNegative() {\r\n        return this.currentGroove < NEUTRAL_GROOVE_POINT;\r\n    }\r\n\r\n    function setFrameContext() {\r\n        this.currentFrameId++;\r\n\r\n        if (this.currentFrameId > 100000) {\r\n            this.currentFrameId = 1;\r\n        }\r\n    }\r\n\r\n    function paintFrame() {\r\n        if (this.shaking) {\r\n            this.knob.nudge();\r\n        } else {\r\n            this.knob.center();\r\n        }\r\n\r\n        this.canvas.draw();\r\n    }\r\n\r\n    function calculateGroove() {\r\n        if (this.knob.isWorking()) {\r\n            this.currentGroove = this.knob.getValue();\r\n        } else if (isPositive.call(this)) {\r\n            this.currentGroove -= GROOVE_DECAY;\r\n        } else if (isNegative.call(this)) {\r\n            this.currentGroove += GROOVE_DECAY;\r\n        }\r\n\r\n        if (\r\n            this.currentGroove > (NEUTRAL_GROOVE_POINT - (GROOVE_DECAY * 2)) &&\r\n            this.currentGroove < (NEUTRAL_GROOVE_POINT + (GROOVE_DECAY * 2))\r\n        ) {\r\n            this.currentGroove = NEUTRAL_GROOVE_POINT;\r\n        }\r\n\r\n        this.knob.setValue(this.currentGroove);\r\n    }\r\n\r\n    function calculateTimelineContext() {\r\n        if (this.knob.isWorking()) {\r\n            if (this.currentGroove > HIGH_GROOVE_THRESHOLD) {\r\n                this.timers.lowGrooveStart = null;\r\n                calculatePositiveContext.call(this);\r\n                return;\r\n            } else if (this.currentGroove < LOW_GROOVE_THRESHOLD) {\r\n                this.timers.highGrooveStart = null;\r\n                calculateNegativeContext.call(this);\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.timers.lowGrooveStart = null;\r\n        this.timers.highGrooveStart = null;\r\n        this.shaking = false;\r\n    }\r\n\r\n    // liking it a lot\r\n    function calculatePositiveContext() {\r\n        if (!this.timers.highGrooveStart) {\r\n            this.timers.highGrooveStart = this.currentFrameId;\r\n            this.shaking = true;\r\n            this.canvas.emit(\"positiveSpark\", 10);\r\n\r\n        } else if (this.timers.highGrooveStart + LENGTH_PER_SHAKE <= this.currentFrameId) {\r\n            this.timers.highGrooveStart = null;\r\n            this.currentGroove = HIGH_GROOVE_THRESHOLD;\r\n            this.knob.stopCurrentDrag();\r\n            this.shaking = false;\r\n            this.canvas.emit(\"positiveSpark\", 100);\r\n        }\r\n    }\r\n\r\n    // hating it a lot\r\n    function calculateNegativeContext() {\r\n        if (!this.timers.lowGrooveStart) {\r\n            this.timers.lowGrooveStart = this.currentFrameId;\r\n            this.shaking = true;\r\n            this.canvas.emit(\"negativeSpark\", 10);\r\n\r\n        } else if (this.timers.lowGrooveStart + LENGTH_PER_SHAKE <= this.currentFrameId) {\r\n            this.timers.lowGrooveStart = null;\r\n            this.currentGroove = LOW_GROOVE_THRESHOLD;\r\n            this.knob.stopCurrentDrag();\r\n            this.shaking = false;\r\n            this.canvas.emit(\"negativeSpark\", 100);\r\n        }\r\n    }\r\n\r\n    function sendFramesPackage (idxStart, idxEnd) {\r\n        this.synchronising = true;\r\n\r\n        $.ajax(\"/ajax/savegroove\", {\r\n            type: \"POST\",\r\n            data: { frames: this.data.reviewFrames.slice(idxStart, idxEnd) },\r\n            success: $.proxy(this.onSyncSuccess, this),\r\n            error: $.proxy(this.onSyncFail, this)\r\n        });\r\n    },\r\n    \r\n        onSyncSuccess : function()\r\n        {\r\n            this.data.synchronising = false;\r\n\r\n            if(this.data.songIsOver)\r\n            {\r\n                this.config.container.ref.removeClass(\"loading\");\r\n                this.config.container.ref.addClass(\"completed\");\r\n            }\r\n        },\r\n\r\n        onSyncFail : function()\r\n        {\r\n            this.data.synchronising = false;\r\n        },\r\n\r\n\r\n})(jQuery);\r\n\r\n/*\r\n        addEvents : function()\r\n        {\r\n            this._super();\r\n\r\n            $(window).resize( $.proxy(this.onWindowResize, this) );\r\n            this.config.joystick.ref.draggable({\r\n                containment : \"parent\",\r\n                axis        : \"y\",\r\n                disabled    : false,\r\n                start       : $.proxy(this.onGrooveStart, this),\r\n                stop        : $.proxy(this.onGrooveStop, this),\r\n                drag        : $.proxy(function(event, ui) { if(!this.isPlayingSong()) return false;}, this)\r\n            });\r\n\r\n            $('body>div').bind(\"dragstart\", function(event, ui){\r\n                  event.stopPropagation();\r\n            });\r\n        },\r\n\r\n        getContextSizes : function()\r\n        {\r\n            this.config.canvas = {ref : this.config.container.ref.find(\"canvas\")};\r\n            if(this.config.canvas)\r\n            {\r\n                var ref = this.config.canvas.ref,\r\n                    node = ref.get(0);\r\n\r\n                this.config.sizes = {\r\n                    top     : 0,\r\n                    left    : 0,\r\n                    height  : ref.height(),\r\n                    width   : ref.width()\r\n                };\r\n\r\n                node.height = ref.height();\r\n                node.width = ref.width();\r\n                this.config.context = node.getContext(\"2d\");\r\n            }\r\n        },\r\n\r\n        addJoystick : function()\r\n        {\r\n            var joy = this.element.find(\".joystick\"),\r\n                b = joy.find(\"b\");\r\n\r\n            this.joystickData = {\r\n                containerRef    : joy,\r\n                containerHeight : joy.innerHeight(),\r\n                ref             : b,\r\n                height          : b.outerHeight(),\r\n                actualHeight    : 0,\r\n                containerPosition : null\r\n            };\r\n\r\n            this.config.joystick.actualHeight = this.config.joystick.containerHeight - this.config.joystick.height;\r\n\r\n            joy.css({\r\n                \"top\" : (this.config.container.height/2) - (this.config.joystick.containerHeight / 2),\r\n                \"left\": (this.config.container.width/2) - (joy.outerWidth() / 2)\r\n            });\r\n            this.config.joystick.containerPosition = joy.position();\r\n\r\n            this.centerGrooveKnob();\r\n        },\r\n\r\n        centerGrooveKnob : function()\r\n        {\r\n            if(this.config.joystick)\r\n            {\r\n                this.config.joystick.ref.css(\"top\", ((this.config.joystick.containerHeight / 2) - (this.config.joystick.height / 2)) + \"px\");\r\n            }\r\n        },\r\n\r\n        animate : function()\r\n        {\r\n            if(this.data.animating)\r\n            {\r\n                if(!this.appHasFocus())\r\n                {\r\n                    this.focusLostError();\r\n                }\r\n                else\r\n                {\r\n                    if(this.frameShouldRender())\r\n                    {\r\n                        this.tick();\r\n                        this.render();\r\n                    }\r\n                }\r\n\r\n\r\n                var scope = this;\r\n                requestAnimationFrame(function() { scope.animate(); });\r\n            }\r\n        },\r\n\r\n        frameShouldSave : function()\r\n        {\r\n            return  !this.data.paused && (this.data.savetick + SAVE_FRAMERATE <= this.getNow());\r\n        },\r\n\r\n        render : function()\r\n        {\r\n            try {\r\n                this.calculateGrooveCurve();\r\n                this.displayFrequency();\r\n                this.displayGroove();\r\n                this.updateMultiplierUi();\r\n                this.updateUiStatuses();\r\n                this.addClasses();\r\n                this.runGuiFx();\r\n\r\n                this._super();\r\n            } catch(e) {\r\n                console.trace(e.message);\r\n            }\r\n        },\r\n\r\n        displayGroove : function()\r\n        {\r\n            var groove = parseInt(this.data.groove*100, 10),\r\n                context = this.config.context;\r\n\r\n            if(groove > 99) groove = \"\";\r\n\r\n            context.beginPath();\r\n            context.arc(50, this.config.sizes.height - 50, 35, 0, 2 * Math.PI, false);\r\n            context.fillStyle = 'rgba(250,250,250,.8)';\r\n            context.fill();\r\n            context.closePath();\r\n\r\n            context.font = '20pt Tahoma';\r\n            context.fillStyle = '#000';\r\n            context.fillText(groove + \"\", 35, this.config.sizes.height - 35);\r\n\r\n            if(!this.data.grooving)\r\n            {\r\n                var position = Math.abs(this.data.groove-1) * this.config.joystick.actualHeight;\r\n                this.config.joystick.ref.css(\"top\", position + \"px\");\r\n            }\r\n        },\r\n\r\n        displayFrequency : function()\r\n        {\r\n            var frequency = this.data.frequency,\r\n                i = 0,\r\n                len = frequency.length,\r\n                context = this.config.context,\r\n                containerHeight = this.config.sizes.height,\r\n                width = Math.ceil(this.config.sizes.width / len);\r\n\r\n            context.clearRect (0, 0, this.config.sizes.width, this.config.sizes.height);\r\n\r\n            for(var freq, color, height; i < len; i++)\r\n            {\r\n                freq = frequency[i];\r\n                height = containerHeight * freq;\r\n                color = parseInt(255 * freq, 10);\r\n\r\n                if(height > containerHeight) height = containerHeight;\r\n                else if(height < 1) height = 1;\r\n\r\n                if(color > 250) color = 250;\r\n                else if(color < 40) color = 40;\r\n\r\n                context.beginPath();\r\n                context.rect(i * width, containerHeight - height, width, height);\r\n                context.fillStyle = 'rgb('+ color +','+ color +','+ color +')';\r\n                context.fill();\r\n            }\r\n        },\r\n\r\n\r\n        updateUiStatuses : function()\r\n        {\r\n            var container = this.config.container,\r\n                context = this.config.context;\r\n\r\n            if(this.data.multiplier !== 0)\r\n            {\r\n                context.beginPath();\r\n                context.rect(20, 20, 50, 50);\r\n                context.fillStyle = 'rgba(0,0,0,.8)';\r\n                context.fill();\r\n\r\n                context.font = '20pt Tahoma';\r\n                context.fillStyle = '#fff';\r\n                context.fillText(\"X \" + this.data.multiplier, 20, 50);\r\n            }\r\n\r\n            if(this.data.suckpowering)\r\n            {\r\n                context.beginPath();\r\n                context.rect(20, 50, 150, 50);\r\n                context.fillStyle = 'rgba(0,0,0,.8)';\r\n                context.fill();\r\n\r\n                context.font = '20pt Tahoma';\r\n                context.fillStyle = '#fff';\r\n                context.fillText(\"Suckpowering!\", 20, 75);\r\n            }\r\n\r\n            if(this.data.starpowering)\r\n            {\r\n                context.beginPath();\r\n                context.rect(20, 50, 150, 50);\r\n                context.fillStyle = 'rgba(0,0,0,.8)';\r\n                context.fill();\r\n\r\n                context.font = '20pt Tahoma';\r\n                context.fillStyle = '#fff';\r\n                context.fillText(\"Starpowering!\", 20, 75);\r\n            }\r\n        },\r\n\r\n        addClasses : function()\r\n        {\r\n            var container = this.config.container;\r\n\r\n            if(this.data.shaking !== container.shaking)\r\n            {\r\n                this.data.shaking ?\r\n                    container.ref.addClass(\"shaking\") :\r\n                    container.ref.removeClass(\"shaking\");\r\n                container.shaking = this.data.shaking;\r\n            }\r\n            /*\r\n            if(this.data.starpowering !== container.starpowering)\r\n            {\r\n                this.data.starpowering ?\r\n                    container.ref.addClass(\"starpowering\") :\r\n                    container.ref.removeClass(\"starpowering\");\r\n                container.starpowering = this.data.starpowering;\r\n            }\r\n\r\n            if(this.data.suckpowering !== container.suckpowering)\r\n            {\r\n                this.data.suckpowering ?\r\n                    container.ref.addClass(\"suckpowering\") :\r\n                    container.ref.removeClass(\"suckpowering\");\r\n                container.suckpowering = this.data.suckpowering;\r\n            }\r\n\r\n            if(this.data.multiplier !== container.multiplier)\r\n            {\r\n                container.ref.removeClass(\"multiplier_\" + container.multiplier);\r\n                container.ref.addClass(\"multiplier_\" + this.data.multiplier);\r\n                container.multiplier = this.data.multiplier;\r\n            }     * /\r\n            /*\r\n            if(this.data.status !== container.status)\r\n            {\r\n                container.ref.removeClass(\"status_\" + container.status);\r\n                container.ref.addClass(\"status_\" + this.data.status);\r\n                container.status = this.data.status;\r\n            }* /\r\n\r\n            if(this.data.synchronising !== container.synchronising)\r\n            {\r\n                this.data.synchronising ?\r\n                    container.ref.addClass(\"synchronising\") :\r\n                    container.ref.removeClass(\"synchronising\");\r\n                container.multiplier = this.data.multiplier;\r\n            }\r\n\r\n            /* handled in canvas now.\r\n            if(this.data.timers.positiveMultiplierStart !== container.buildingPositiveMultiplier)\r\n            {\r\n                this.data.timers.positiveMultiplierStart ?\r\n                    container.ref.addClass(\"multiplier-build-up\") :\r\n                    container.ref.removeClass(\"multiplier-build-up\");\r\n                container.buildingPositiveMultiplier = this.data.timers.positiveMultiplierStart;\r\n            }\r\n\r\n            if(this.data.timers.negativeMultiplierStart !== container.buildingNegativeMultiplier)\r\n            {\r\n                this.data.timers.negativeMultiplierStart ?\r\n                    container.ref.addClass(\"multiplier-build-down\") :\r\n                    container.ref.removeClass(\"multiplier-build-down\");\r\n                container.buildingNegativeMultiplier = this.data.timers.negativeMultiplierStart;\r\n            }       * /\r\n        },\r\n\r\n        runGuiFx : function()\r\n        {\r\n            this.shakeJoystick();\r\n        },\r\n\r\n        shakeJoystick : function()\r\n        {\r\n            if(!this.data.shaking && !this.config.joystick.moved) return;\r\n\r\n            var originalTopValue = this.config.joystick.containerPosition.top,\r\n                originalLeftValue = this.config.joystick.containerPosition.left,\r\n                topValue = null,\r\n                leftValue = null,\r\n                random = 0;\r\n\r\n            if(this.data.shaking)\r\n            {\r\n                random = Math.random();\r\n                topValue = (random <= 0.5) ? originalTopValue + 2 : originalTopValue - 2;\r\n                random = Math.random();\r\n                leftValue = (random <= 0.5) ? originalLeftValue + 2 : originalLeftValue - 2;\r\n                this.config.joystick.moved = true;\r\n            }\r\n            else if(this.config.joystick.moved)\r\n            {\r\n                this.config.joystick.moved = false;\r\n                topValue = originalTopValue;\r\n                leftValue = originalLeftValue;\r\n            }\r\n\r\n            this.config.joystick.containerRef.css({\r\n                top : topValue + \"px\",\r\n                left : leftValue + \"px\"\r\n            });\r\n        },\r\n\r\n        updateMultiplierUi : function()\r\n        {\r\n            if(!this.data.timers.positiveMultiplierStart && !this.data.timers.negativeMultiplierStart)\r\n                return;\r\n\r\n            var pct = 0, deg, styles,\r\n                context = this.config.context,\r\n                level = Math.abs(this.data.multiplier);\r\n\r\n            if(this.data.timers.positiveMultiplierStart)\r\n            {\r\n                 pct = (this.data.frameId - this.data.timers.positiveMultiplierStart) / FRAMES_PER_MULTIPLIER;\r\n            }\r\n\r\n            else if(this.data.timers.negativeMultiplierStart)\r\n            {\r\n                 pct = (this.data.frameId - this.data.timers.negativeMultiplierStart) / FRAMES_PER_MULTIPLIER;\r\n            }\r\n\r\n            if(level < 3)\r\n            {\r\n                // Draw the previous underlying stroke\r\n                if(level > 0)\r\n                {\r\n                    context.beginPath();\r\n                    context.arc(50, this.config.sizes.height - 50, 40, 0, 2 * Math.PI, false);\r\n                    context.lineWidth = 12;\r\n                    context.strokeStyle = 'rgba(0,0,0,' + (0.3 * level) + ')';\r\n                    context.stroke();\r\n                    context.closePath();\r\n                }\r\n\r\n                context.beginPath();\r\n                context.arc(50, this.config.sizes.height - 50, 40, 0, (2*pct) * Math.PI, false);\r\n                context.lineWidth = 12;\r\n                context.strokeStyle = 'rgba(0,0,0,' + (0.3 * (level+1)) + ')';\r\n                context.stroke();\r\n                context.closePath();\r\n            }\r\n            else\r\n            {\r\n                context.beginPath();\r\n                context.arc(50, this.config.sizes.height - 50, 40, 0, 2 * Math.PI, false);\r\n                context.lineWidth = 12;\r\n                context.strokeStyle = '#FF0000';\r\n                context.stroke();\r\n                context.closePath();\r\n            }\r\n        },\r\n\r\n        toggleMultiplier : function(isPositive)\r\n        {\r\n            if(isPositive)\r\n            {\r\n                if(this.data.multiplier < MAX_MULTIPLIER)\r\n                {\r\n                    if(this.data.multiplier < -1) this.data.multiplier = 0;\r\n                    this.data.multiplier++;\r\n                    this.data.timers.activeMultiplierStart = this.data.frameId;\r\n                    this.debug(\"data\", \"Multiplier positive applied\", this.data.multiplier);\r\n                }\r\n            }\r\n            else\r\n            {\r\n                if(this.data.multiplier > -MAX_MULTIPLIER)\r\n                {\r\n                    if(this.data.multiplier > 1) this.data.multiplier = 0;\r\n                    this.data.multiplier--;\r\n                    this.data.timers.activeMultiplierStart = this.data.frameId;\r\n                    this.debug(\"data\", \"Multiplier negative applied\", this.data.multiplier);\r\n                }\r\n            }\r\n        },\r\n\r\n        sendFramesPackage : function(idxStart, idxEnd)\r\n        {\r\n            this.data.synchronising = true;\r\n\r\n            $.ajax(this.config.tmtUrl, {\r\n                type : \"POST\",\r\n                data: { frames : this.data.reviewFrames.slice(idxStart, idxEnd) },\r\n                success : $.proxy(this.onSyncSuccess, this),\r\n                error : $.proxy(this.onSyncFail, this)\r\n            });\r\n        },\r\n\r\n        appHasFocus : function()\r\n        {\r\n            return this.data.appHasFocus === true;\r\n        },\r\n\r\n        focusLostError : function()\r\n        {\r\n            if(this.isPlayingSong())\r\n            {\r\n                var scope = this,\r\n                    container = this.config.container;\r\n\r\n                if(!this.config.container.isFocusLost)\r\n                {\r\n                    var btn = container.ref.find(\".focus-lost button\"),\r\n                        onclick = function() {\r\n                            container.ref.removeClass(\"focuslost\");\r\n                            container.isFocusLost = false;\r\n                            btn.unbind(\"click\");\r\n                            scope.resume();\r\n                        };\r\n\r\n                    this.pause();\r\n                    this.config.container.isFocusLost = true;\r\n                    btn.click(onclick);\r\n                    container.ref.addClass(\"focuslost\");\r\n                    btn.focus();\r\n                }\r\n            }\r\n        },\r\n\r\n        // LOOPS - The Math\r\n        // Tick contains the calulations that have no direct visual impact\r\n        tick : function()\r\n        {\r\n            try {\r\n                this.logFrame();\r\n                this.checkGrooveIntensity();\r\n                this.checkStarpowers();\r\n                this.checkMultiplier();\r\n                this.checkMultiplierTimers();\r\n                this.decayGrooveCurve();\r\n                this.saveCurrentFrame();\r\n                this.saveEquilizerFrame();\r\n            } catch(e) {\r\n                console.error(e);\r\n                console.trace(e.message);\r\n            }\r\n        },\r\n\r\n        logFrame : function()\r\n        {\r\n            this.data.frameId++;\r\n            this.data.tick = this.getNow();\r\n        },\r\n\r\n        saveCurrentFrame : function()\r\n        {\r\n            if(this.frameShouldSave())\r\n            {\r\n                var lastFrame = null,\r\n                    idx = null\r\n                    currentFrame = {\r\n                        gv  : this.data.groove,\r\n                        st  : this.data.starpowering === true ? 1 : 0,\r\n                        su  : this.data.suckpowering === true ? 1 : 0,\r\n                        m   : this.data.multiplier,\r\n                        p   : this.data.position,\r\n                        o   : 0\r\n                   };\r\n\r\n                if(this.data.reviewFrames.length > 0)\r\n                {\r\n                    lastFrame = this.data.reviewFrames[this.data.reviewFrames.length - 1];\r\n                }\r\n\r\n                if(lastFrame && (lastFrame[\"p\"] != currentFrame[\"p\"] || lastFrame[\"gv\"] != currentFrame[\"gv\"]) )\r\n                {\r\n                    this.data.reviewFrames.push(currentFrame);\r\n                    this.data.savetick = this.getNow();\r\n                }\r\n                else if(!lastFrame)\r\n                {\r\n                    this.data.reviewFrames.push(currentFrame);\r\n                    this.data.savetick = this.getNow();\r\n                }\r\n            }\r\n\r\n            if(this.data.frameId % FRAMES_PER_SAVE === 0)\r\n            {\r\n                this.sendFramesPackage(this.data.lastframeSent, this.data.reviewFrames.length);\r\n                this.data.lastframeSent = this.data.reviewFrames.length - 1;\r\n            }\r\n        },\r\n\r\n        calculateGrooveCurve : function()\r\n        {\r\n            if(this.config.joystick)\r\n            {\r\n                var value       = parseFloat(this.config.joystick.ref.css(\"top\")),\r\n                    height      = this.config.joystick.actualHeight,\r\n                    pctOfHeight = value / height,\r\n                    computedValue = (1 - pctOfHeight) + this.data.decay,\r\n                    centerRange = GROOVE_DECAY_VALUE * 2;\r\n\r\n                this.data.groove = computedValue;\r\n\r\n                if      (this.data.groove < 0)  this.data.groove = 0;\r\n                else if (this.data.groove > 1)  this.data.groove = 1;\r\n                else if (this.data.groove > (MIDDLE_GROOVE_VALUE - centerRange) && this.data.groove < (MIDDLE_GROOVE_VALUE + centerRange))\r\n                                                this.data.groove = 0.5;\r\n            }\r\n        },\r\n\r\n        checkStarpowers : function()\r\n        {\r\n            if(this.data.starpowering)\r\n            {\r\n                if(this.data.timers.starpowerStart + FRAMES_PER_POWERING <= this.data.frameId)\r\n                {\r\n                    this.data.timers.starpowerStart = null;\r\n                    this.data.starpowering = false;\r\n                }\r\n            }\r\n\r\n            if(this.data.suckpowering)\r\n            {\r\n                if(this.data.timers.suckpowerStart + FRAMES_PER_POWERING <= this.data.frameId)\r\n                {\r\n                    this.data.timers.suckpowerStart = null;\r\n                    this.data.suckpowering = false;\r\n                }\r\n            }\r\n        },\r\n\r\n        checkGrooveIntensity : function()\r\n        {\r\n            if(this.data.grooving)\r\n            {\r\n                // liking it a lot\r\n                if(this.data.groove >= HIGH_GROOVE_THRESHOLD && !this.data.starpowering)\r\n                {\r\n                    this.data.timers.lowGrooveStart = null;\r\n\r\n                    if(!this.data.timers.highGrooveStart)\r\n                    {\r\n                        this.data.timers.highGrooveStart = this.data.frameId;\r\n                    }\r\n                    else if(this.data.timers.highGrooveStart + FRAME_PER_SHAKE <= this.data.frameId)\r\n                    {\r\n                        this.data.shaking = false;\r\n                        this.data.timers.highGrooveStart = null;\r\n                        this.data.starpowering = true;\r\n                        this.data.timers.starpowerStart = this.data.frameId;\r\n                    }\r\n                    else if(this.data.timers.highGrooveStart + FRAMES_TO_SHAKE <= this.data.frameId)\r\n                    {\r\n                        this.data.shaking = true;\r\n                    }\r\n                    return;\r\n                }\r\n                // hating it a lot\r\n                else if(this.data.groove <= LOW_GROOVE_THRESHOLD && !this.data.suckpowering)\r\n                {\r\n                    this.data.timers.highGrooveStart = null;\r\n                    if(!this.data.timers.lowGrooveStart)\r\n                    {\r\n                        this.data.timers.lowGrooveStart = this.data.frameId;\r\n                    }\r\n                    else if(this.data.timers.lowGrooveStart + FRAME_PER_SHAKE <= this.data.frameId)\r\n                    {\r\n                        this.data.shaking = false;\r\n                        this.data.suckpowering = true;\r\n                        this.data.timers.lowGrooveStart = null;\r\n                        this.data.timers.suckpowerStart = this.data.frameId;\r\n                    }\r\n                    else if(this.data.timers.lowGrooveStart + FRAMES_TO_SHAKE <= this.data.frameId)\r\n                    {\r\n                        this.data.shaking = true;\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n\r\n            // Reset if the groove is in between\r\n            this.data.shaking = false;\r\n            this.data.timers.lowGrooveStart = null;\r\n            this.data.timers.highGrooveStart = null;\r\n        },\r\n\r\n        /**\r\n         * Checks the global mutiplier timer to set or remove the multiplier\r\n         * flag. Also triggers\r\n         * /\r\n        checkMultiplier : function()\r\n        {\r\n            // if the timer is triggered, user is multiplying from liking a long time\r\n            if(this.data.timers.activeMultiplierStart)\r\n            {\r\n                // Cancel out the multiplier timer, animation is complete\r\n                if(this.data.timers.activeMultiplierStart + FRAMES_PER_MULTIPLY <= this.data.frameId)\r\n                {\r\n                    this.data.multiplier = 0;\r\n                    this.data.timers.activeMultiplierStart = null;\r\n                }\r\n            }\r\n            // if no timer is set, but we are powering start it right away\r\n            else if(this.data.starpowering)\r\n            {\r\n                this.toggleMultiplier(true);\r\n            }\r\n            else if(this.data.suckpowering)\r\n            {\r\n                this.toggleMultiplier(false);\r\n            }\r\n        },\r\n\r\n        checkMultiplierTimers : function()\r\n        {\r\n            // If user is not actively pressing on the knob, no\r\n            // multiplier can become active;\r\n            if(this.data.grooving)\r\n            {\r\n                if(this.data.groove >= HIGH_GROOVE_MULTIPLIER_THRESHOLD)\r\n                {\r\n                    // When there is enjoyment, cancel out any negative\r\n                    // multiplers\r\n                    this.data.timers.negativeMultiplierStart = null;\r\n                    if(this.data.multiplier < 0) this.data.multiplier = 0;\r\n\r\n                    if(!this.data.timers.positiveMultiplierStart)\r\n                    {\r\n                        this.data.timers.positiveMultiplierStart = this.data.frameId;\r\n                    }\r\n                    else if(this.data.timers.positiveMultiplierStart + FRAMES_PER_MULTIPLIER <= this.data.frameId)\r\n                    {\r\n                        this.toggleMultiplier(true);\r\n                        this.data.timers.positiveMultiplierStart = null;\r\n                    }\r\n                    return;\r\n                }\r\n                else if(this.data.groove <= LOW_GROOVE_MULTIPLIER_THRESHOLD)\r\n                {\r\n                    // When there isnt enjoyment, cancel out any positive\r\n                    // multiplers\r\n                    this.data.timers.positiveMultiplierStart = null;\r\n                    if(this.data.multiplier > 0) this.data.multiplier = 0;\r\n\r\n                    if(!this.data.timers.negativeMultiplierStart)\r\n                    {\r\n                        this.data.timers.negativeMultiplierStart = this.data.frameId;\r\n                    }\r\n                    else if(this.data.timers.negativeMultiplierStart + FRAMES_PER_MULTIPLIER <= this.data.frameId)\r\n                    {\r\n                        this.toggleMultiplier(false);\r\n                        this.data.timers.negativeMultiplierStart = null;\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n\r\n            this.data.timers.positiveMultiplierStart = null;\r\n            this.data.timers.negativeMultiplierStart = null;\r\n        },\r\n\r\n        decayGrooveCurve : function()\r\n        {\r\n            if(this.config.joystick)\r\n            {\r\n                this.data.decay = 0;\r\n                if(!this.data.grooving && !this.data.starpowering && !this.data.suckpowering)\r\n                {\r\n                    if      (this.data.groove > MIDDLE_GROOVE_VALUE) this.data.decay = -GROOVE_DECAY_VALUE;\r\n                    else if (this.data.groove < MIDDLE_GROOVE_VALUE) this.data.decay = GROOVE_DECAY_VALUE;\r\n                }\r\n            }\r\n        },\r\n\r\n        onSongEnd : function()\r\n        {\r\n            this._super();\r\n\r\n            this.data.songIsOver = true;\r\n            this.config.container.ref.addClass(\"loading\");\r\n\r\n            var last = this.data.reviewFrames[this.data.reviewFrames.length - 1];\r\n            if(this.data.lastframeSent < this.data.reviewFrames.length)\r\n            {\r\n                last[\"o\"] = 1;\r\n            }\r\n            // Make sure we send in at least a frame.\r\n            else\r\n            {\r\n                last[\"o\"] = 1;\r\n                this.data.reviewFrames.push(last);\r\n            }\r\n\r\n            this.sendFramesPackage(this.data.lastframeSent, this.data.reviewFrames.length);\r\n        },\r\n\r\n        onGrooveStart : function()\r\n        {\r\n            this.data.grooving = true;\r\n        },\r\n\r\n        onGrooveStop : function()\r\n        {\r\n            this.data.grooving = false;\r\n        },\r\n\r\n        onSyncSuccess : function()\r\n        {\r\n            this.data.synchronising = false;\r\n\r\n            if(this.data.songIsOver)\r\n            {\r\n                this.config.container.ref.removeClass(\"loading\");\r\n                this.config.container.ref.addClass(\"completed\");\r\n            }\r\n        },\r\n\r\n        onSyncFail : function()\r\n        {\r\n            this.data.synchronising = false;\r\n        },\r\n\r\n        isPlayingSong : function()\r\n        {\r\n            return this.data.status === \"playing\";\r\n        },\r\n\r\n        onWindowResize : function()\r\n        {\r\n            //this.setDisplayHeight();\r\n        },\r\n\r\n        onWindowVisibility : function(isVisible)\r\n        {\r\n            this.data.appHasFocus = isVisible;\r\n            this.debug(\"data\", \"appHasFocus\", this.data.appHasFocus);\r\n        }*/\r\n\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var Canvas = namespace(\"Tmt.Components.Reviewer\").Canvas = function (element) {\r\n        this.rootNode = element;\r\n        this.node = element.get(0);\r\n        this.context = this.node.getContext('2d');\r\n        this.emitters = {};\r\n\r\n        addEvents.call(this);\r\n    };\r\n\r\n    inherit([], Canvas, {\r\n\r\n        addEmitter : function(id, x, y) {\r\n            var emitter = new Tmt.Components.Reviewer.Emitter.ParticleEmitter();\r\n            emitter.setCanvas(this.node); \r\n            emitter.moveTo(x, y);\r\n\r\n            this.emitters[id] = emitter;\r\n        },\r\n\r\n        emit : function(id, qty) {  \r\n            this.emitters[id].start(qty);\r\n        },\r\n\r\n        draw : function() {\r\n            this.context.clearRect(0, 0, this.node.width, this.node.height);\r\n            for(var i in  this.emitters) {\r\n                if (this.emitters[i].isRunning()) {\r\n                    this.emitters[i].run();\r\n                    this.emitters[i].render();\r\n                }\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n    function addEvents () {\r\n        $(window).on('resize', debounce(applyCurrentSize.bind(this)));\r\n        applyCurrentSize.call(this);\r\n    }\r\n\r\n    function applyCurrentSize () {\r\n        this.node.height = this.rootNode.parent().height();\r\n        this.node.width = this.rootNode.parent().width();\r\n    }\r\n\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var Vector = namespace(\"Tmt.Components.Reviewer.Emitter\").Vector = function (x, y) {\r\n        this.y = y;\r\n        this.x = x;\r\n    };\r\n\r\n    inherit([], Vector, {\r\n\r\n        add : function (vector) {\r\n            this.x = this.x + vector.x;\r\n            this.y = this.y + vector.y;\r\n        }\r\n\r\n    });\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var Vector = Tmt.Components.Reviewer.Emitter.Vector;\r\n\r\n    var Particle = namespace(\"Tmt.Components.Reviewer.Emitter\").Particle = function (canvas, x, y) {\r\n        this.size = Math.random() * 10 + 15;\r\n\r\n        this.position = new Vector(x, y);\r\n        var velocityX = (Math.random() * 5) * (Math.random() >= 0.5 ? 1 : -1);\r\n        var velocityY = Math.random() * 5;\r\n\r\n        this.velocity = new Vector(velocityX, velocityY);\r\n        this.acceleration = new Vector(0, 0.1);\r\n        this.lifespan = Math.random() * 350;\r\n\r\n        this.image = new Image();\r\n        this.image.src = '/assets/img/spark.png';\r\n        this.context = canvas.getContext('2d');\r\n\r\n        this.image.onload = function () {\r\n            this.context.drawImage(this.image, this.position.x, this.position.y);\r\n        }.bind(this);\r\n    };\r\n\r\n    inherit([], Particle, {\r\n\r\n        update: function () {\r\n            this.velocity.add(this.acceleration);\r\n            this.position.add(this.velocity);\r\n            this.lifespan -= 1;\r\n        },\r\n\r\n        isDead: function () {\r\n            return this.lifespan < 0;\r\n        },\r\n\r\n        paint: function () {\r\n            this.context.save();\r\n            if (this.lifespan < 10) {\r\n                this.context.globalAlpha = this.lifespan / 100;\r\n            }\r\n            \r\n            this.context.drawImage(this.image, this.position.x, this.position.y);\r\n            this.context.restore();\r\n        }\r\n\r\n    });\r\n\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var Particle = Tmt.Components.Reviewer.Emitter.Particle,\r\n        Vector = Tmt.Components.Reviewer.Emitter.Vector;\r\n\r\n    var ParticleEmitter = namespace(\"Tmt.Components.Reviewer.Emitter\").ParticleEmitter = function () {\r\n        this.particles = [];\r\n        this.position = new Vector(0, 0);\r\n    };\r\n\r\n    inherit([], ParticleEmitter, {\r\n\r\n        isRunning: function () {\r\n            return this.particles.length > 0;\r\n        },\r\n\r\n        setCanvas: function (canvas) {\r\n            this.canvas = canvas;\r\n        },\r\n\r\n        moveTo: function (x, y) {\r\n            this.position = new Vector(x, y);\r\n        },\r\n\r\n        start: function (quantity) {\r\n            for (var i = 0; i < quantity; i++) {\r\n                this.particles.push(new Particle(this.canvas, this.position.x, this.position.y));\r\n            }\r\n        },\r\n\r\n        run: function () {\r\n            for (var i = this.particles.length - 1; i >= 0; i--) {\r\n                this.particles[i].update();\r\n                if (this.particles[i].isDead()) {\r\n                    this.particles.pop();\r\n                }\r\n            }\r\n        },\r\n\r\n        render: function () {\r\n            for (var i = this.particles.length - 1; i >= 0; i--) {\r\n                this.particles[i].paint();\r\n            }\r\n        }\r\n\r\n    });\r\n\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var forms = [];\r\n\r\n    /**\r\n     * Ajax-enabled forms public bootstraper\r\n     */\r\n    var AjaxFormsInitializer = namespace(\"Tmt.Initializers\").AjaxFormsInitializer = function () {\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], AjaxFormsInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        },\r\n\r\n        'getForms': function() {\r\n            return forms;\r\n        }\r\n    });\r\n\r\n    function bindPageForms() {\r\n        forms = [];\r\n        $(\"form[data-ctrl-mode=ajax]\").each(function () {\r\n            forms.push(new Tmt.Components.AjaxForm($(this)));\r\n        });\r\n\r\n        this.emit('bound', this, forms);\r\n    }\r\n\r\n    function addEvents(app) {\r\n        app.on('ready', bindPageForms.bind(this));\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var PlayerInitializer = namespace(\"Tmt.Initializers\").PlayerInitializer = function () {\r\n        this.initialize();\r\n        this.players = [];\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], PlayerInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n    function addEvents(app) {\r\n        $(onDomReady.bind(this));\r\n    }\r\n\r\n    function onDomReady() {\r\n        var components = $(\"*[data-song-vid]\");\r\n        if (components.length > 0) {\r\n            for (var i = 0; i < components.length; i++) {\r\n                this.players.push(new Tmt.Components.Player($(components.get(i))));\r\n            }\r\n            includeYoutubeScript.call(this);\r\n        }\r\n        this.emit('bound', this);\r\n    }\r\n\r\n    function onYouTubeReady() {\r\n        for (var i = 0; i < this.players.length; i++) {\r\n            this.players[i].render();\r\n        }\r\n    }\r\n\r\n    function includeYoutubeScript() {\r\n        var tag = document.createElement('script');\r\n        tag.src = \"//www.youtube.com/player_api\";\r\n\r\n        window.onYouTubeIframeAPIReady = onYouTubeReady.bind(this);\r\n\r\n        var firstScriptTag = document.getElementsByTagName('script')[0];\r\n        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var reviewerWindow;\r\n\r\n    var ReviewerInitializer = namespace(\"Tmt.Initializers\").ReviewerInitializer = function () {\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], ReviewerInitializer, {\r\n        'build': function (app) {\r\n            reviewerWindow = $('[data-attr=\"tmt-reviewer\"]');\r\n            if (reviewerWindow.length > 0) {\r\n                app.initializers.PlayerInitializer.on('bound', bindToPlayer.bind(this));\r\n            }\r\n        }\r\n    });\r\n\r\n    function bindToPlayer(playerInitializer) {\r\n        if (playerInitializer.players.length === 1) {\r\n            playerInitializer.players[0].on('embeded', function(player) {\r\n                player.getStreamer().addEventListener('onReady', function() {\r\n                    new Tmt.Components.Reviewer.Reviewer(reviewerWindow, player);\r\n                });\r\n            });\r\n        }\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var ProfileInitializer = namespace(\"Tmt.Initializers\").ProfileInitializer = function () {\r\n        this.notificationTimestamp = 0;\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], ProfileInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n    function addEvents(app) {\r\n        app.on('ready', bindProfileHooks.bind(this));\r\n        app.initializers.UpvoteFormsInitializer.on('bound', function(upvoteFormsInitializer){\r\n            bindToUpvoteForms(app, upvoteFormsInitializer);\r\n        }.bind(this));\r\n    }\r\n\r\n    function bindProfileHooks(app) {\r\n        app.on(\"profileFirstPopulated\", bindToProfile.bind(this));\r\n    }\r\n\r\n    function bindToUpvoteForms(app, UpvoteFormsInitializer) {\r\n        var fn = function(value, upvoteForm) {\r\n            onUpvoteValue(app.profile, value, upvoteForm);\r\n        }.bind(this);\r\n\r\n        var i = 0,\r\n            forms = UpvoteFormsInitializer.getForms(),\r\n            len = forms.length;\r\n\r\n        for ( ; i < len; i++) {\r\n            forms[i].on(\"valueChange\", fn);\r\n        }\r\n    }\r\n\r\n    function bindToProfile(app, profile) {\r\n        if (profile.id > 0) {\r\n            bindNotifier.call(this, app, profile);\r\n            pingNotifications.call(this, profile);\r\n        }\r\n    }\r\n\r\n    function bindNotifier(app, profile) {\r\n        var notifier = new Tmt.Components.Notifier($('[data-ctrl=notifier]'), profile);\r\n        notifier.on('notificationRead', clearNotifications.bind(this));\r\n    }\r\n\r\n    function pingNotifications(profile) {\r\n        $.ajax({\r\n            dataType : \"html\",\r\n            url : \"/ajax/whatsUp/\",\r\n            contentType:\"application/json; charset=utf-8\",\r\n            data : { timestamp: this.notificationTimestamp},\r\n            success : function(data) {\r\n                data = JSON.parse(data);\r\n                for(var i = 0, len = data.length; i < len; i++) {\r\n                    profile.addNotification(data[i]);\r\n                }\r\n                setTimeout(pingNotifications.bind(this), 1000 * 60 * 2);\r\n            }.bind(this)\r\n        });\r\n\r\n        this.notificationTimestamp = parseInt(Date.now() / 1000, 10);\r\n    }\r\n\r\n    function clearNotifications(notificationsIds, destinationUrl) {\r\n         $.ajax({\r\n            dataType : \"html\",\r\n            url : \"/ajax/okstfu/\",\r\n            contentType:\"application/json; charset=utf-8\",\r\n            data : { ids: notificationsIds},\r\n            success : function(data) {\r\n                if (destinationUrl) {\r\n                    window.location = destinationUrl;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function onUpvoteValue(profile, value, upvoteForm) {\r\n        var type = upvoteForm.isTrack() ? \"tracks\" : \"albums\";\r\n        if (value > 0) {\r\n            profile.addUpvote(type, upvoteForm.getObjectId(), value);\r\n        } else {\r\n            profile.removeUpvote(type, upvoteForm.getObjectId());\r\n        }\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Ajax-enabled forms public bootstraper\r\n     */\r\n    var SearchInitializer = namespace(\"Tmt.Initializers\").SearchInitializer = function () {\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], SearchInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n    function bindForm() {\r\n        new Tmt.Components.SearchForm();\r\n    }\r\n\r\n    function addEvents(app) {\r\n        app.on('ready', bindForm.bind(this));\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var boxes = [];\r\n\r\n    /**\r\n     * Ajax-enabled forms public bootstraper\r\n     */\r\n    var UpvoteFormsInitializer = namespace(\"Tmt.Initializers\").UpvoteFormsInitializer = function () {\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], UpvoteFormsInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        },\r\n        'getForms': function () {\r\n            return boxes;\r\n        }\r\n    });\r\n\r\n    function addEvents(app) {\r\n        app.initializers.AjaxFormsInitializer.on('bound', bindToAjaxForms.bind(this));\r\n        app.on('profileFirstPopulated', updateStateFirstTime.bind(this));\r\n    }\r\n\r\n    function bindToAjaxForms(ajaxFormsInitializer, forms) {\r\n        filter('[data-ctrl=\"upvote-widget\"]', forms).forEach(function(form){\r\n            boxes.push(new Tmt.Components.UpvoteForm(form));\r\n        });\r\n        this.emit('bound', this);\r\n    }\r\n\r\n    function updateStateFirstTime(app, profile) {\r\n        boxes.forEach(function (box) {\r\n            var matchFound = profile.getVoteByObjectId(box.getType(), box.getObjectId());\r\n\r\n            if (matchFound) {\r\n                box.setValue(matchFound);\r\n            }\r\n\r\n            // Though we have no value to apply on the control,\r\n            // it is still time to activate it.\r\n            box.unlock();\r\n        });\r\n\r\n        this.emit(\"synched\", this);\r\n    }\r\n\r\n})(jQuery);\r\n"]}