{"version":3,"sources":["app.js","player.js"],"names":[],"mappings":"AAAA;AACA;AACA;ACFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["\nwindow.tmt = {};\n","jQuery(function () {\n\n    var $ = window.jQuery;\n\n    $(\"*[data-song-vid]\").each(function () {\n        var el = $(this),\n            videoId = el.attr(\"data-song-vid\");\n\n        if (videoId != \"\") {\n            appendVideoAndScript(el, videoId);\n        } else {\n            queryForKey(el, el.attr(\"data-song-slug\"));\n        }\n    });\n\n    function queryForKey(el, url) {\n        $.getJSON('/ajax/ytkey/' + url, function (response) {\n            if (response.youtubekey.length === 11) {\n                appendVideoAndScript(el, response.youtubekey);\n            }\n        });\n    }\n\n    function appendVideoAndScript(el, videoId) {\n        el.append('<iframe id=\"songplayer_youtube_api\" scrolling=\"no\" marginwidth=\"0\" marginheight=\"0\" frameborder=\"0\" src=\"//www.youtube.com/embed/' + videoId + '?enablejsapi=1&amp;iv_load_policy=3&amp;playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;autoplay=0&amp;loop=0&amp;origin=' + window.location.origin + '\"></iframe>');\n\n        var tag = document.createElement('script');\n        tag.src = \"//www.youtube.com/player_api\";\n\n        var firstScriptTag = document.getElementsByTagName('script')[0];\n        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\n    }\n\n    tmt.onPlayerStateChange = function (newState) {\n        /*\n        -1 (unstarted)\n        0 (ended)\n        1 (playing)\n        2 (paused)\n        3 (buffering)\n        5 (video cued) */\n        var el = $('*[data-attr=tmt-player] .play'),\n            player = this;\n\n        if (newState.data === 1) {\n            el.removeClass(\"fa-play\");\n            el.addClass(\"fa-pause\");\n            tmt.playerIsPlaying = true;\n            tmt.playerTick(player);\n        }\n        else if (newState.data === 2) {\n            el.removeClass(\"fa-pause\");\n            el.addClass(\"fa-play\");\n            tmt.playerIsPlaying = false;\n        }\n    }\n\n    tmt.onPlayerReady = function (event) {\n        var player = this,\n            streamer = $('*[data-attr=tmt-player]'),\n            play = streamer.find('.play');\n\n        streamer.find(\".duration\").html(_toReadableTime(player.getDuration()));\n        streamer.find(\".position\").html(_toReadableTime(0));\n\n        streamer.find(\".progress-wrap .progress\").click(function (e) {\n            if (tmt.playerIsPlaying) {\n                var offset = $(this).offset();\n                var relX = e.pageX - offset.left;\n                var pctLocation = relX / $(\"*[data-attr=tmt-player] .progress-wrap .progress\").width();\n                player.seekTo(pctLocation * player.getDuration(), true);\n            }\n        });\n\n        play.removeClass(\"fa-stop\");\n        play.addClass(\"fa-play\");\n\n        play.click(function () {\n            tmt.playingRange = null;\n            (player.getPlayerState() != 1) ?\n                player.playVideo() :\n                player.pauseVideo();\n        });\n\n        $(\"*[data-from]\").click(function () {\n            var el = $(this);\n            tmt.playingRange = [parseInt(el.attr(\"data-from\"), 10), parseInt(el.attr(\"data-to\"), 10)];\n            (player.getPlayerState() != 1) ? player.playVideo() : player.pauseVideo();\n            player.seekTo(tmt.playingRange[0], true);\n        });\n    };\n\n    tmt.playerTick = function (player) {\n\n        var currentTime = player.getCurrentTime(),\n            durationTime = player.getDuration(),\n            currentPositionPct = (currentTime / durationTime) * 100;\n\n        $('*[data-attr=tmt-player] .position').html(_toReadableTime(currentTime));\n\n        $('*[data-attr=tmt-player] .cursor').css(\"left\", currentPositionPct + \"%\");\n        $('*[data-attr=tmt-player] .progress .loaded-bar').css(\"width\", (player.getVideoLoadedFraction() * 100) + \"%\");\n        $('*[data-attr=tmt-player] .progress .playing-bar').css(\"width\", currentPositionPct + \"%\");\n        $('*[data-attr=tmt-player] .progress .playing-bar').attr(\"aria-valuenow\", currentTime);\n\n        if (tmt.playerIsPlaying) {\n\n            if (tmt.playingRange) {\n\n                if (currentTime >= tmt.playingRange[1]) {\n                    tmt.playingRange = null;\n                    player.pauseVideo();\n                }\n                else if (currentTime <= tmt.playingRange[0]) {\n                    player.seekTo(tmt.playingRange[0], true);\n                }\n            }\n\n            setTimeout(function () { tmt.playerTick(player) }, 200);\n        }\n    };\n\n    function _toReadableTime(seconds) {\n        var time = new Date(1000 * seconds),\n            mins = (\"0\" + time.getMinutes()).slice(-2),\n            secs = (\"0\" + time.getSeconds()).slice(-2);\n\n        return mins + \":\" + secs;\n    }\n});\n\nfunction onYouTubePlayerAPIReady() {\n    var player = new YT.Player('songplayer_youtube_api');\n    player.addEventListener('onReady', tmt.onPlayerReady.bind(player));\n    player.addEventListener('onStateChange', tmt.onPlayerStateChange.bind(player));\n}\n\n"]}