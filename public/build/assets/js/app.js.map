{"version":3,"sources":["globals.js","event-emitter.js","app.js","profile.js","ajax-form.js","player.js","upvote-form.js","search-form.js","notifier.js","ajax-forms-initializer.js","player-initializer.js","profile-initializer.js","search-initializer.js","upvote-forms-initializer.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACrGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["\"use strict\";\r\n\r\n/**\r\n * Globally exposed namespacing function.\r\n * @public\r\n * @param {string} namespace\r\n * @return {object} A referene to the object created\r\n */\r\nfunction namespace(namespace) {\r\n    var object = window, tokens = namespace.split(\".\"), token;\r\n\r\n    while (tokens.length > 0) {\r\n        token = tokens.shift();\r\n\r\n        if (typeof object[token] === \"undefined\") {\r\n            object[token] = {};\r\n        }\r\n\r\n        object = object[token];\r\n    }\r\n\r\n    return object;\r\n}\r\n\r\n/**\r\n * Globally exposed extending function.\r\n * @param {object} target\r\n * @param {hash} source\r\n * @return {object}\r\n */\r\nfunction extend(target, source) {\r\n    target = target || {};\r\n    for (var prop in source) {\r\n        if (typeof source[prop] === 'object') {\r\n            target[prop] = extend(target[prop], source[prop]);\r\n        } else {\r\n            target[prop] = source[prop];\r\n        }\r\n    }\r\n    return target;\r\n}\r\n\r\n/**\r\n * Sets up inheritance of the child object to the objects\r\n * supplied by the parents object.\r\n * @param {array} parents\r\n * @param {object} child\r\n * @param {hash} properties\r\n * @return {object} An object with inheritance\r\n */\r\nfunction inherit(parents, child, properties) {\r\n    var childPrototype = properties;\r\n\r\n    for (var i in parents) {\r\n        var parentPrototype = Object.create(parents[i].prototype);\r\n        childPrototype = extend(parentPrototype, childPrototype);\r\n    }\r\n\r\n    child.prototype = childPrototype;\r\n    child.prototype.constructor = child;\r\n\r\n    return child;\r\n}\r\n\r\n/**\r\n * Globally filters out jQuery elements matching selector\r\n * from the haystack. This expects javascript objects that\r\n * have a public \"element\" property.\r\n * @param {string} selector\r\n * @param {array} haystack\r\n * @return {array} matches\r\n */\r\nfunction filter(selector, haystack) {\r\n    var matches = [],\r\n        i = -1;\r\n\r\n    while (++i < haystack.length) {\r\n        if (haystack[i].element && haystack[i].element.is(selector)) {\r\n            matches.push(haystack[i]);\r\n        }\r\n    }\r\n\r\n    return matches;\r\n}\r\n","(function (undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * @namespace Tmt.EventEmitter\r\n     * @property {array} events A collection of object events and callbacks.\r\n     */\r\n    var EventEmitter = namespace(\"Tmt\").EventEmitter = function() {\r\n        this.events = null;\r\n    };\r\n\r\n    inherit([Evemit], namespace(\"Tmt\").EventEmitter, {\r\n\r\n        /**\r\n         * Initializes the event emitter object.\r\n         * @method\r\n         * @public\r\n         */\r\n        'initialize': function () {\r\n            // Exposing the creation in a prototype method\r\n            // ensures child classes will have an instantiated value\r\n            // even if they don't go through the constructor.\r\n            this.events = {};\r\n        }\r\n    });\r\n\r\n}());\r\n","(function (undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * The global wrapper for the application instance.\r\n     * @namespace Tmt.App\r\n     * @extends {Tmt.EventEmitter}\r\n     * @property {Tmt.Models.Profile} profile - An active session profile\r\n     * @property {Array} initializers - An array of Tmt.Initializers object.\r\n     */\r\n    var App = namespace(\"Tmt\").App = function () {\r\n        this.profile = null;\r\n        this.initializers = [];\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], App, {\r\n\r\n        /**\r\n         * Boots the application instance\r\n         * @public\r\n         * @method\r\n         */\r\n        boot: function () {\r\n            this.profile = new Tmt.Models.Profile();\r\n            prepareInitializers.call(this);\r\n            this.emit(\"ready\", this);\r\n        },\r\n\r\n        /**\r\n         * Assigns session data from PHP to this javascript\r\n         * session instance.\r\n         * @method\r\n         * @public\r\n         */\r\n        setData: function (data) {\r\n            if (data.profile) {\r\n                this.profile.setData(data.profile);\r\n            }\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Loads all initializer objects that it can dynamically find\r\n     * in the Tmt.Initializers namespace and then builds them.\r\n     * @method\r\n     * @private\r\n     */\r\n    function prepareInitializers() {\r\n        // Create an intance of each initializer.\r\n        for (var type in Tmt.Initializers) {\r\n            this.initializers[type] = new Tmt.Initializers[type]();\r\n        }\r\n\r\n        // Run the initialization. This is done in two steps because\r\n        // initializers may depend on one another.\r\n        for (var type in this.initializers) {\r\n            this.initializers[type].build(this);\r\n        }\r\n    }\r\n\r\n}());\r\n","(function (undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * The Profile object is the frontend equivalent of the\r\n     * backend Profile model.\r\n     * @namespace Tmt.Models.Profile\r\n     * @property {array} albumUpvotes\r\n     * @property {array} trackUpvotes\r\n     * @property {array} activities\r\n     */\r\n    var Profile = namespace(\"Tmt.Models\").Profile = function () {\r\n        this.notifications = [];\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], Profile, {\r\n\r\n        /**\r\n         * Applies backend session data to the object.\r\n         * @param {hash} userData\r\n         * @public\r\n         * @method\r\n         * @fires Profile#upvoteSet\r\n         */\r\n        setData: function (userData) {\r\n            this.username = userData.username;\r\n            this.email = userData.email;\r\n            this.slug = userData.slug;\r\n            this.name = userData.name;\r\n            this.id = userData.id;\r\n            this.emit(\"dataSet\", this);\r\n\r\n            this.albumUpvotes = indexUpvotes(\"albumUpvotes\", userData);\r\n            this.trackUpvotes = indexUpvotes(\"trackUpvotes\", userData);\r\n\r\n            if (this.albumUpvotes && this.albumUpvotes.length > 0) {\r\n                this.emit(\"upvoteSet\", \"album\", this.albumUpvotes);\r\n            }\r\n\r\n            if (this.trackUpvotes && this.trackUpvotes.length > 0) {\r\n                this.emit(\"upvoteSet\", \"track\", this.trackUpvotes);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Adds a new vote value to the current profile\r\n         * @param {string} type One of track or album\r\n         * @param {string} key The {type}'s id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        addUpvote: function (type, key, value) {\r\n            if (type == \"album\") {\r\n                return this.addAlbumUpvote(key, value);\r\n            } else if (type == \"track\") {\r\n                return this.addTrackUpvote(key, value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Add a new album vote\r\n         * @param {string} key album id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        addAlbumUpvote: function (key, value) {\r\n            this.albumUpvotes[key] = value;\r\n            this.emit(\"upvoteUpdate\", \"album\", this.albumUpvotes);\r\n        },\r\n\r\n        /**\r\n         * Add a new track vote\r\n         * @param {string} key track id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        addTrackUpvote: function (key, value) {\r\n            this.trackUpvotes[key] = value;\r\n            this.emit(\"upvoteUpdate\", \"track\", this.trackUpvotes);\r\n        },\r\n\r\n        /**\r\n         * Removes an existing vote value to the current profile\r\n         * @param {string} type One of track or album\r\n         * @param {string} key The {type}'s id\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        removeUpvote: function (type, key) {\r\n            if (type == \"album\") {\r\n                return this.removeAlbumUpvote(key, value);\r\n            } else if (type == \"track\") {\r\n                return this.removeTrackUpvote(key, value);\r\n            }\r\n        },\r\n\r\n        /**\r\n         * Removes an existing album vote\r\n         * @param {string} key album id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        removeAlbumUpvote: function (type, key) {\r\n            delete this.albumUpvotes[key];\r\n            this.emit(\"upvoteUpdate\", \"album\", this.upvotes);\r\n        },\r\n\r\n        /**\r\n         * Removes an existing track vote\r\n         * @param {string} key track id\r\n         * @param {string} value\r\n         * @fires Profile#upvoteUpdate\r\n         * @public\r\n         * @method\r\n         */\r\n        removeTrackUpvote: function (type, key) {\r\n            delete this.trackUpvotes[key];\r\n            this.emit(\"upvoteUpdate\", \"track\", this.upvotes);\r\n        },\r\n\r\n        /**\r\n         * Adds a user activity notification (viewed or not)\r\n         * @param {hash} notification\r\n         * @fires Profile#notification\r\n         * @public\r\n         * @method \r\n         */\r\n        addNotification : function (notification) {\r\n            this.notifications.push(notification);\r\n\r\n            if (this.notifications.length > 10) {\r\n                this.notifications.length = 10;\r\n            }\r\n\r\n            this.emit(\"notification\", notification);\r\n        }\r\n    });\r\n\r\n    /**\r\n     * Data saved in the database is not easily serachable\r\n     * in javascript. This method bridges the two.\r\n     * @param {string} key one of track or album\r\n     * @param {hash} data values as stored in the BD\r\n     * @return {hash} A javascript-oriented indexed object\r\n     * @private\r\n     * @method\r\n     */\r\n    function indexUpvotes(key, data) {\r\n        var indexed = [];\r\n        if (data && data[key]) {\r\n            for (var i in data[key]) {\r\n                var id = data[key][i].id,\r\n                    value = data[key][i].vote;\r\n\r\n                indexed[id] = value;\r\n            }\r\n        }\r\n        return indexed;\r\n    }\r\n\r\n}());\r\n","(function() {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * A form object that can be captured using ajax.\r\n     * @param {jQuery} el\r\n     */\r\n    var AjaxForm = namespace(\"Tmt.Components\").AjaxForm = function(el) {\r\n        this.element = el;\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([ Tmt.EventEmitter ], AjaxForm, {\r\n        render : function() {\r\n            this.addEvents();\r\n        },\r\n\r\n        addEvents : function() {\r\n            this.element.on(\"submit\", onSubmit.bind(this));\r\n            this.element.on(\"onBeforeSubmit\", onBeforeSubmit.bind(this));\r\n            this.emit(\"bound\", this);\r\n        }\r\n    });\r\n\r\n\r\n    function onSubmit(event) {\r\n        event.preventDefault();\r\n\r\n        this.emit(\"beforeSubmit\", this, event);\r\n\r\n        var formElement = this.element;\r\n\r\n        $.ajax({\r\n            url: formElement.attr(\"action\"),\r\n            data: new FormData(formElement.get(0)),\r\n            cache: false,\r\n            processData: false,\r\n            contentType: false,\r\n            type: formElement.attr('method'),\r\n            success: onSubmitSuccess.bind(this)\r\n        });\r\n\r\n        this.emit(\"submit\", this);\r\n    };\r\n\r\n    function onBeforeSubmit()\r\n    {\r\n        this.element.addClass(\"working\");\r\n    }\r\n\r\n    function onSubmitSuccess(response) {\r\n        /*\r\n        var newVersion = $(html);\r\n\r\n        this.element.replaceWith(newVersion);\r\n        this.element = newVersion;\r\n        this.addEvents();*/\r\n\r\n        this.emit(\"submitSuccess\", response, this);\r\n        // this.emit(\"afterRender\", this);\r\n    }\r\n\r\n}());\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var Player = namespace(\"Tmt.Components\").Player = function (element) {\r\n        this.element = element;\r\n        this.embed = null;\r\n        this.ytPlayer = null;\r\n        this.isPlaying = false;\r\n        this.range = null;\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], Player, {\r\n\r\n        'render': function () {\r\n            this.hasVideoId() ?\r\n                embedVideo.call(this) :\r\n                queryForKey.call(this);\r\n        },\r\n\r\n        'getEmbedId': function () {\r\n            if (this.hasVideoId) {\r\n                return \"tmt_player_\" + this.getVideoId();\r\n            }\r\n        },\r\n\r\n        'getVideoId': function () {\r\n            return this.element.data(\"song-vid\");\r\n        },\r\n\r\n        'setVideoId': function (id) {\r\n            this.element.data(\"song-vid\", id);\r\n        },\r\n\r\n        'hasVideoId': function () {\r\n            return this.getVideoId() != \"\";\r\n        },\r\n\r\n        'getSongSlug': function () {\r\n            return this.element.data(\"song-slug\");\r\n        }\r\n    });\r\n\r\n    function queryForKey() {\r\n        $.getJSON('/ajax/ytkey/' + this.getSongSlug(), onYtKeyReceived.bind(this));\r\n    }\r\n\r\n    function onYtKeyReceived(response) {\r\n        if (response.youtubekey.length === 11) {\r\n            this.setVideoId(response.youtubekey);\r\n            embedVideo.call(this);\r\n        }\r\n    }\r\n\r\n    function embedVideo() {\r\n        var id = this.getEmbedId();\r\n        var iframeHtml =\r\n            '<iframe id=\"' + id + '\" scrolling=\"no\" marginwidth=\"0\" ' +\r\n            'marginheight=\"0\" frameborder=\"0\" src=\"//www.youtube.com/embed/' +\r\n            this.getVideoId() + '?enablejsapi=1&amp;iv_load_policy=3&amp;' +\r\n            'playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0' +\r\n            '&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;' +\r\n            'autoplay=0&amp;loop=0&amp;origin=' + window.location.origin + '\"></iframe>'\r\n\r\n        this.element.append(iframeHtml);\r\n        this.embed = $(\"#\" + id);\r\n\r\n        this.ytPlayer = new YT.Player(id);\r\n\r\n        this.ytPlayer.addEventListener('onReady', onPlayerReady.bind(this));\r\n        this.ytPlayer.addEventListener('onStateChange', onPlayerStateChange.bind(this));\r\n    }\r\n\r\n    function onPlayerStateChange(newState) {\r\n        /*\r\n        -1 (unstarted)\r\n        0 (ended)\r\n        1 (playing)\r\n        2 (paused)\r\n        3 (buffering)\r\n        5 (video queued) */\r\n        var controlButton = this.element.find('.play');\r\n\r\n        if (newState.data === 1) {\r\n            controlButton.removeClass(\"fa-play\");\r\n            controlButton.addClass(\"fa-pause\");\r\n\r\n            this.isPlaying = true;\r\n            onPlayerTick.call(this);\r\n        }\r\n        else if (newState.data === 2) {\r\n            controlButton.removeClass(\"fa-pause\");\r\n            controlButton.addClass(\"fa-play\");\r\n\r\n            this.isPlaying = false;\r\n        }\r\n    }\r\n\r\n    function onProgressClick(e) {\r\n        if (this.isPlaying) {\r\n            var progressBar = this.element.find(\".progress-wrap .progress\"),\r\n                offset = progressBar.offset(),\r\n                relX = e.pageX - offset.left,\r\n                pctLocation = relX / progressBar.width();\r\n            this.ytPlayer.seekTo(pctLocation * this.ytPlayer.getDuration(), true);\r\n        }\r\n    };\r\n\r\n    function onPlayBtnClick(e) {\r\n        // Ranges wil be back shortly\r\n        this.playingRange = null;\r\n\r\n        (this.ytPlayer.getPlayerState() != 1) ?\r\n            this.ytPlayer.playVideo() :\r\n            this.ytPlayer.pauseVideo();\r\n    }\r\n\r\n\r\n    function onPlayerReady(event) {\r\n        this.element.find(\".duration\").html(toReadableTime(this.ytPlayer.getDuration()));\r\n        this.element.find(\".position\").html(toReadableTime(0));\r\n        this.element.find(\".progress-wrap .progress\").click(onProgressClick.bind(this));\r\n\r\n        var playBtn = this.element.find('.play');\r\n        playBtn.removeClass(\"fa-stop\");\r\n        playBtn.addClass(\"fa-play\");\r\n        playBtn.click(onPlayBtnClick.bind(this));\r\n\r\n        // Ranges wil be back shortly\r\n        // $(\"*[data-from]\").click(function () {\r\n        //     var el = $(this);\r\n        //     tmt.playingRange = [parseInt(el.attr(\"data-from\"), 10), parseInt(el.attr(\"data-to\"), 10)];\r\n        //     (player.getPlayerState() != 1) ? player.playVideo() : player.pauseVideo();\r\n        //     player.seekTo(tmt.playingRange[0], true);\r\n        // });\r\n    };\r\n\r\n    function onPlayerTick() {\r\n        var currentTime = this.ytPlayer.getCurrentTime(),\r\n            durationTime = this.ytPlayer.getDuration(),\r\n            currentPositionPct = (currentTime / durationTime) * 100;\r\n\r\n        this.element.find('.position').html(toReadableTime(currentTime));\r\n\r\n        this.element.find('.cursor').css(\"left\", currentPositionPct + \"%\");\r\n        this.element.find('.progress .loaded-bar').css(\"width\", (this.ytPlayer.getVideoLoadedFraction() * 100) + \"%\");\r\n        this.element.find('.progress .playing-bar').css(\"width\", currentPositionPct + \"%\");\r\n        this.element.find('.progress .playing-bar').attr(\"aria-valuenow\", currentTime);\r\n\r\n        if (this.isPlaying) {\r\n            // if (tmt.playingRange) {\r\n\r\n            //     if (currentTime >= tmt.playingRange[1]) {\r\n            //         tmt.playingRange = null;\r\n            //         player.pauseVideo();\r\n            //     }\r\n            //     else if (currentTime <= tmt.playingRange[0]) {\r\n            //         player.seekTo(tmt.playingRange[0], true);\r\n            //     }\r\n            // }\r\n            setTimeout(onPlayerTick.bind(this), 250);\r\n        }\r\n    }\r\n\r\n    function toReadableTime(seconds) {\r\n        var time = new Date(1000 * seconds),\r\n            mins = (\"0\" + time.getMinutes()).slice(-2),\r\n            secs = (\"0\" + time.getSeconds()).slice(-2);\r\n\r\n        return mins + \":\" + secs;\r\n    }\r\n\r\n})(jQuery);\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var UpvoteForm = namespace(\"Tmt.Components\").UpvoteForm = function (ajaxForm) {\r\n        this.ajaxForm = ajaxForm;\r\n        this.element = ajaxForm.element;\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], UpvoteForm, {\r\n\r\n        \"initialize\": function () {\r\n            Tmt.EventEmitter.prototype.initialize.call(this);\r\n\r\n            this.addEvents();\r\n            resetButtons.call(this);\r\n            this.element.addClass(\"initialized\");\r\n        },\r\n\r\n        \"addEvents\": function () {\r\n            this.element.find(\"button\").click(onButtonClick.bind(this));\r\n            this.ajaxForm.on('submitSuccess', onSubmitSuccess.bind(this));\r\n        },\r\n\r\n        \"getType\": function () {\r\n            return this.element.data(\"upvote-type\");\r\n        },\r\n\r\n        \"getObjectId\": function () {\r\n            return this.element.data(\"upvote-object-id\");\r\n        },\r\n\r\n        \"isTrack\": function () {\r\n            return this.getType() == \"track\";\r\n        },\r\n\r\n        \"isAlbum\": function () {\r\n            return this.getType() == \"album\";\r\n        },\r\n\r\n        \"setValue\": function (value) {\r\n            this.element.removeClass(\"liked disliked\");\r\n            this.element.find(\"input[name=vote]\").val(value);\r\n\r\n            if (value == 1) {\r\n                this.element.addClass(\"liked\");\r\n                enableButton(this.element.find('button.up'));\r\n            } else if (value == 2) {\r\n                this.element.addClass(\"disliked\");\r\n                this.element.find('button.down').html('<i class=\"fa fa-thumbs-down\" aria-hidden=\"true\">');\r\n            } else {\r\n                resetButtons.call(this);\r\n            }\r\n\r\n            this.emit('valueChange', value, this);\r\n        },\r\n\r\n        \"getValue\": function () {\r\n            return this.element.find(\"input[name=vote]\").val();\r\n        },\r\n\r\n        \"lock\": function () {\r\n            this.element.find(\"button\").attr(\"disabled\", \"disabled\");\r\n        },\r\n\r\n        \"unlock\": function () {\r\n            this.element.find(\"button\").removeAttr(\"disabled\");\r\n        }\r\n    });\r\n\r\n    function resetButtons() {\r\n        this.element.find('button.up').html('<i class=\"fa fa-thumbs-o-up\" aria-hidden=\"true\">');\r\n        this.element.find('button.down').html('<i class=\"fa fa-thumbs-o-down\" aria-hidden=\"true\">');\r\n    }\r\n\r\n    function enableButton(button) {\r\n        if (button.hasClass(\"up\")) {\r\n            button.html('<i class=\"fa fa-thumbs-up\" aria-hidden=\"true\">');\r\n        }\r\n        if (button.hasClass(\"down\")) {\r\n            button.html('<i class=\"fa fa-thumbs-down\" aria-hidden=\"true\">');\r\n        }\r\n    }\r\n\r\n    function onButtonClick(evt) {\r\n        var clickedValue = evt.target.value;\r\n\r\n        if (clickedValue != this.getValue()) {\r\n            this.setValue(clickedValue);\r\n        } else {\r\n            // twice the same value means the user wants to cancel\r\n            this.setValue(-1);\r\n        }\r\n\r\n        this.lock();\r\n        this.element.submit();\r\n    }\r\n\r\n    function onSubmitSuccess(response, ajaxForm) {\r\n        if (response && response.vote) {\r\n            this.setValue(response.vote);\r\n        }\r\n\r\n        this.unlock();\r\n    }\r\n\r\n})(jQuery);\r\n","\r\n(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var SearchForm = namespace(\"Tmt.Components\").SearchForm = function () {\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], SearchForm, {\r\n\r\n        \"initialize\": function () {\r\n            Tmt.EventEmitter.prototype.initialize.call(this);\r\n\r\n            // search box\r\n            var artistsSearch = new Bloodhound({\r\n                name: 'artists',\r\n                datumTokenizer: Bloodhound.tokenizers.obj.whitespace('artist'),\r\n                queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n                remote: {\r\n                    url: '/ajax/artistSearch/?q=%QUERY',\r\n                    wildcard: '%QUERY'\r\n                }\r\n            }),\r\n                albumsSearch = new Bloodhound({\r\n                    name: 'albums',\r\n                    datumTokenizer: Bloodhound.tokenizers.obj.whitespace('album'),\r\n                    queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n                    remote: {\r\n                        url: '/ajax/albumSearch/?q=%QUERY',\r\n                        wildcard: '%QUERY'\r\n                    }\r\n                }),\r\n                tracksSearch = new Bloodhound({\r\n                    name: 'tracks',\r\n                    datumTokenizer: Bloodhound.tokenizers.obj.whitespace('track'),\r\n                    queryTokenizer: Bloodhound.tokenizers.whitespace,\r\n                    remote: {\r\n                        url: '/ajax/trackSearch/?q=%QUERY',\r\n                        wildcard: '%QUERY'\r\n                    }\r\n                }),\r\n                searchBox = $('.typeahead');\r\n\r\n\r\n            // Listens for when Typeahead a selected a value.\r\n            function typeahead_onSelected(e, data, section) {\r\n                e.preventDefault();\r\n                document.location = $('.tt-cursor a:nth-child(1)').attr('href');\r\n            }\r\n\r\n            artistsSearch.initialize();\r\n            albumsSearch.initialize();\r\n            tracksSearch.initialize();\r\n\r\n            searchBox.on(\"typeahead:selected\", typeahead_onSelected);\r\n\r\n            searchBox.typeahead(\r\n                { minLength: 3, highlight: true, cache: true },\r\n                [\r\n                    {\r\n                        name: 'artists',\r\n                        display: 'artist',\r\n                        source: artistsSearch,\r\n                        cache: true,\r\n                        templates: {\r\n                            header: '<h3>Artists</h3>',\r\n                            empty: '<h3>Artists</h3><p class=\"empty-message\">Could not find matching artists.</p>',\r\n                            suggestion: function (data) { return ['<p><a href=\"/artists/' + data.slug + '/\">' + data.name + '</a></p>'].join(\"\"); }\r\n                        }\r\n                    },\r\n                    {\r\n                        name: 'albums',\r\n                        display: 'album',\r\n                        source: albumsSearch,\r\n                        cache: true,\r\n                        templates: {\r\n                            header: '<h3>Albums</h3>',\r\n                            empty: '<h3>Albums</h3><p class=\"empty-message\">Could not find matching albums.</p>',\r\n                            suggestion: function (data) { return ['<p><a href=\"/albums/' + data.slug + '/\">' + data.name + '</a> by <a href=\"/artists/' + data.slug + '/\">' + data.name + '</a></p>'].join(\"\"); }\r\n                        }\r\n                    },\r\n                    {\r\n                        name: 'tracks',\r\n                        display: 'track',\r\n                        source: tracksSearch,\r\n                        cache: true,\r\n                        templates: {\r\n                            header: '<h3>Tracks</h3>',\r\n                            empty: '<h3>Tracks</h3><p class=\"empty-message\">Could not find matching tracks.</p>',\r\n                            suggestion: function (data) { return ['<p><a href=\"/albums/' + data.slug + '/\">' + data.name + '</a> by <a href=\"/artists/' + data.slug + '/\">' + data.name + '</a></p>'].join(\"\"); }\r\n                        }\r\n                    }\r\n                ]\r\n            );\r\n\r\n        }\r\n    });\r\n\r\n\r\n})(jQuery);\r\n","(function() {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * A user notifier control.\r\n     * @param {jQuery} el\r\n     */\r\n    var Notifier = namespace(\"Tmt.Components\").Notifier = function(el, profile) {\r\n        this.element = el;\r\n        this.profile = profile;\r\n\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([ Tmt.EventEmitter ], Notifier, {\r\n        render : function() {\r\n            this.addEvents();\r\n        },\r\n\r\n        addEvents : function() {\r\n            this.profile.on(\"notification\", onNewNotification.bind(this));\r\n            this.emit(\"bound\", this);\r\n        }\r\n    });\r\n\r\n    function onNewNotification(notification) {\r\n        console.log(notification);\r\n    }\r\n\r\n}());\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Ajax-enabled forms public bootstraper\r\n     */\r\n    var AjaxFormsInitializer = namespace(\"Tmt.Initializers\").AjaxFormsInitializer = function () {\r\n        this.forms = [];\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], AjaxFormsInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n    function bindPageForms() {\r\n        var forms = [];\r\n\r\n        $(\"form[data-ctrl-mode=ajax]\").each(function () {\r\n            var form = new Tmt.Components.AjaxForm($(this));\r\n            form.render();\r\n            forms.push(form);\r\n        });\r\n\r\n        this.forms = forms;\r\n        this.emit('bound', this);\r\n    }\r\n\r\n    function addEvents(app) {\r\n        app.on('ready', bindPageForms.bind(this));\r\n    }\r\n\r\n}(jQuery));\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var PlayerInitializer = namespace(\"Tmt.Initializers\").PlayerInitializer = function () {\r\n        this.initialize();\r\n        this.players = [];\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], PlayerInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n    function addEvents(app) {\r\n        $(onDomReady.bind(this));\r\n    }\r\n\r\n    function onDomReady() {\r\n        var components = $(\"*[data-song-vid]\");\r\n        if (components.length > 0) {\r\n            for (var i = 0; i < components.length; i++) {\r\n                this.players.push(new Tmt.Components.Player($(components.get(i))));\r\n            }\r\n            includeYoutubeScript.call(this);\r\n        }\r\n        this.emit('bound', this);\r\n    }\r\n\r\n    function onYouTubeReady() {\r\n        for (var i = 0; i < this.players.length; i++) {\r\n            this.players[i].render();\r\n        }\r\n    }\r\n\r\n    function includeYoutubeScript() {\r\n        var tag = document.createElement('script');\r\n        tag.src = \"//www.youtube.com/player_api\";\r\n\r\n        window.onYouTubeIframeAPIReady = onYouTubeReady.bind(this);\r\n\r\n        var firstScriptTag = document.getElementsByTagName('script')[0];\r\n        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);\r\n    }\r\n\r\n}(jQuery));\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    var ProfileInitializer = namespace(\"Tmt.Initializers\").ProfileInitializer = function () {\r\n        this.profile = null;\r\n        this.notificationTimestamp = 0;\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], ProfileInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n\r\n    function addEvents(app) {\r\n        app.on('ready', bindProfileHooks.bind(this));\r\n        app.initializers.UpvoteFormsInitializer.on('bound', bindToUpvoteForms.bind(this));\r\n    }\r\n\r\n    function bindProfileHooks(app) {\r\n        this.app = app;\r\n        this.profile = app.profile;\r\n        app.profile.on(\"dataSet\", bindToProfile.bind(this));\r\n    }\r\n\r\n    function bindToUpvoteForms(UpvoteFormsInitializer) {\r\n        for (var i = 0, len = UpvoteFormsInitializer.boxes.length; i < len; i++) {\r\n            var box = UpvoteFormsInitializer.boxes[i];\r\n            box.on(\"valueChange\", onUpvoteValue.bind(this));\r\n        }\r\n    }\r\n\r\n    function bindToProfile(profile) {\r\n        if (profile.id > 0) {   \r\n            bindNotifier.call(this, profile);\r\n            pingNotifications.call(this, profile);\r\n        }\r\n    }\r\n\r\n    function pingNotifications() {    \r\n        this.notificationTimestamp = Date.now();\r\n\r\n        $.ajax({\r\n            dataType : \"html\",\r\n            url : \"/ajax/whatsUp/\",\r\n            contentType:\"application/json; charset=utf-8\",\r\n            data : { timestamp: this.notificationTimestamp},\r\n            success : function(data) {\r\n                data = JSON.parse(data);\r\n                for(var i = 0, len = data.length; i < len; i++) {\r\n                    this.profile.addNotification(data[i]);\r\n                }\r\n                setTimeout(pingNotifications.bind(this), 1000 * 60 * 2);\r\n            }.bind(this)\r\n        });\r\n    }\r\n\r\n    function bindNotifier(profile) {\r\n        var notifier = new Tmt.Components.Notifier($('[data-ctrl=notifier]'), profile);\r\n        notifier.render();\r\n    }\r\n\r\n    function onUpvoteValue(value, upvoteForm) {\r\n        var type = upvoteForm.isTrack() ? \"tracks\" : \"albums\";\r\n\r\n        if (value > 0) {\r\n            this.profile.addUpvote(type, upvoteForm.getObjectId(), value);\r\n        } else {\r\n            this.profile.removeUpvote(type, upvoteForm.getObjectId());\r\n        }\r\n    }\r\n\r\n}(jQuery));\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Ajax-enabled forms public bootstraper\r\n     */\r\n    var SearchInitializer = namespace(\"Tmt.Initializers\").SearchInitializer = function () {\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], SearchInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n    function bindForm() {\r\n        new Tmt.Components.SearchForm();\r\n    }\r\n\r\n    function addEvents(app) {\r\n        app.on('ready', bindForm.bind(this));\r\n    }\r\n\r\n}(jQuery));\r\n","(function ($, undefined) {\r\n\r\n    \"use strict\";\r\n\r\n    /**\r\n     * Ajax-enabled forms public bootstraper\r\n     */\r\n    var UpvoteFormsInitializer = namespace(\"Tmt.Initializers\").UpvoteFormsInitializer = function () {\r\n        this.boxes = [];\r\n        this.initialize();\r\n    };\r\n\r\n    inherit([Tmt.EventEmitter], UpvoteFormsInitializer, {\r\n        'build': function (app) {\r\n            addEvents.call(this, app);\r\n        }\r\n    });\r\n\r\n    function addEvents(app) {\r\n        app.initializers.AjaxFormsInitializer.on('bound', bindToAjaxForms.bind(this));\r\n        app.profile.on('upvoteSet', updateStateFirstTime.bind(this));\r\n    }\r\n\r\n    function bindToAjaxForms(AjaxFormsInitializer) {\r\n        var upvoteForms = filter('[data-ctrl=\"upvote-widget\"]', AjaxFormsInitializer.forms);\r\n\r\n        for (var i = 0, len = upvoteForms.length; i < len; i++) {\r\n            this.boxes.push(new Tmt.Components.UpvoteForm(upvoteForms[i]));\r\n        }\r\n\r\n        this.emit('bound', this);\r\n    }\r\n\r\n    function updateStateFirstTime(type, newValues) {\r\n\r\n        for (var i = 0, len = this.boxes.length; i < len; i++) {\r\n            var box = this.boxes[i];\r\n\r\n            if (box.getType() == type) {\r\n                var matching = newValues[box.getObjectId()];\r\n                if (matching) {\r\n                    box.setValue(matching);\r\n                }\r\n\r\n                box.unlock();\r\n            }\r\n        }\r\n\r\n        this.emit(\"completed\");\r\n    }\r\n\r\n}(jQuery));\r\n"]}