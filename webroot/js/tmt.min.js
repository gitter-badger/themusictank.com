function onYouTubePlayerAPIReady(){var a=new YT.Player("songplayer_youtube_api");a.addEventListener("onReady",tmt.onPlayerReady.bind(a)),a.addEventListener("onStateChange",tmt.onPlayerStateChange.bind(a))}var tmt=window.tmt||{};$(function(){function a(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function b(){if(j.window.scrollTop()>70?(j[".navbar"].addClass("opaque"),j[".breadcrumbs"].addClass("opaque")):(j[".navbar"].removeClass("opaque"),j[".breadcrumbs"].removeClass("opaque")),j[".header-wrapper"].length){var a=j.window.height(),b=j.window.width(),c=j[".header-wrapper"].innerWidth()/j[".header-wrapper"].innerHeight();scrollTop=j.window.scrollTop(),scrolledDistance=scrollTop/5,wrapHeight=j[".header-wrapper"].innerHeight(),imgHeight=j[".header-wrapper img.clean"].height(),opacityVal=1-scrollTop/150,threshold=5,c>b/a?j[".header-wrapper"].hasClass("vertical")||j[".header-wrapper"].addClass("vertical"):j[".header-wrapper"].hasClass("vertical")&&j[".header-wrapper"].removeClass("vertical"),scrolledDistance>threshold&&wrapHeight>scrolledDistance?(j[".header-wrapper img.clean"].css("opacity",opacityVal),j[".header-wrapper .mask"].css("background-position-y",-(.3*scrolledDistance)+"px"),imgHeight-wrapHeight>scrolledDistance&&j[".header-wrapper img"].css("top",-scrolledDistance+"px")):threshold>=scrolledDistance&&(j[".header-wrapper .mask"].css("background-position-y","0px"),j[".header-wrapper img"].css("top","0px"),j[".header-wrapper img.clean"].css("opacity",1))}}function c(a){var b=$(this);a.preventDefault(),$.ajax(b.attr("href")).done(function(a){var d=b.parent();d.html(a),d.find("a.follow, a.unfollow").on("click",c)})}function d(){return $.ajax({dataType:"html",url:"/ajax/okstfu/",success:function(a){o.html(a)}}),!1}function e(){$.ajax({dataType:"html",url:"/ajax/whatsup/",success:function(a){o.html(a),$(".notifier li.mark a").click(d),setTimeout(e,9e4)}})}function f(a,b){var c=a.find("canvas").get(0),d=c.getContext("2d"),e=a.height(),f=a.width();c.width=f,c.height=e,d.beginPath(),d.arc(e/2,f/2,f,0,2*Math.PI,!1),d.fillStyle="#000000",d.fill();var g=0;b.liking_pct>0&&(d.beginPath(),d.arc(e/2,f/2,f,0,360*b.liking_pct,!1),d.fillStyle="green",d.fill(),g=360*b.liking_pct),b.disliking_pct>0&&(d.beginPath(),d.arc(e/2,f/2,f,g,360*b.disliking_pct,!1),d.fillStyle="red",d.fill())}function g(a,b){var c=a.get(0),d=c.getContext("2d"),e=a.parent().height(),f=a.parent().width();c.width=f,c.height=e,d.beginPath(),d.moveTo(0,e/2);for(var g=0,h=b.length;h>g;g++);d.lineTo(f,e/2),d.strokeStyle="#333",d.strokeWidth="1.2",d.stroke()}function h(a,b){var c=a.get(0),d=c.getContext("2d"),e=a.parent().height(),f=a.parent().width();console.log(a.parent()),c.width=f,c.height=e;for(var g=0,h=b.length,i=f/h,j=128;h>g;g++)j=Math.abs(128-parseInt(b[g],10)),d.beginPath(),d.rect(g*i,j,i,-j),d.fillStyle="rgba(0,0,0.4)",d.fill()}function i(){}var j={window:$(window),".navbar":$(".navbar"),".breadcrumbs":$(".breadcrumbs"),".header-wrapper":$(".header-wrapper"),".header-wrapper .mask":$(".header-wrapper .mask"),".header-wrapper img":$(".header-wrapper img"),".header-wrapper img.clean":$(".header-wrapper img.clean")};j.window.scroll(a(b,60)),$("a.follow, a.unfollow").on("click",c);var k=new Bloodhound({name:"artists",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.artist)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/artistssearch/?q=%QUERY"}),l=new Bloodhound({name:"albums",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.album)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/albumssearch/?q=%QUERY"}),m=new Bloodhound({name:"tracks",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.track)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/trackssearch/?q=%QUERY"});k.initialize(),l.initialize(),m.initialize();var n=$(".typeahead");n.on("typeahead:selected",function(a,b,c){document.location="/"+[c,"view",b.slug].join("/"),a.preventDefault()}),n.typeahead({minLength:3,highlight:!0,cache:!0},[{name:"artists",displayKey:"artist",source:k.ttAdapter(),cache:!0,templates:{header:"<h3>Artists</h3>",suggestion:function(a){return["<p>",a.artist,"</p>"].join("")}}},{name:"albums",displayKey:"album",source:l.ttAdapter(),cache:!0,templates:{header:"<h3>Albums</h3>",suggestion:function(a){return["<p>",a.album," by ",a.artist,"</p>"].join("")}}},{name:"tracks",displayKey:"track",source:m.ttAdapter(),cache:!0,templates:{header:"<h3>Tracks</h3>",suggestion:function(a){return["<p>",a.track," from ",a.album,"</p>"].join("")}}}]);var o=$(".notifier");o.length>0&&setTimeout(e,300);var o=$("#mapCanvas");if(o.length>0){var p={center:new google.maps.LatLng(45.4516675,-73.5904749),zoom:8,disableDefaultUI:!0,draggable:!1,disableDoubleClickZoom:!1,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"water",elementType:"geometry",stylers:[{color:"#193341"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#2c5a71"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#29768a"},{lightness:-37}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#406d80"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#406d80"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#3e606f"},{weight:2},{gamma:.84}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"administrative",elementType:"geometry",stylers:[{weight:.6},{color:"#1a3541"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#2c5a71"}]}]};new google.maps.Map(o.get(0),p)}$("*[data-post-load]").each(function(){var a=$(this);a.load(a.attr("data-post-load"))}),$("*[data-song]").each(function(){var a=$(this),b=(a.attr("id"),a.attr("data-song"));$.getJSON("/ajax/getsong/"+b,function(b){if(11===b.vid.length){videoId=b.vid,a.append('<iframe id="songplayer_youtube_api" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="//www.youtube.com/embed/'+videoId+"?enablejsapi=1&amp;iv_load_policy=3&amp;playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;autoplay=0&amp;loop=0&amp;origin="+window.location.origin+'"></iframe>');var c=document.createElement("script");c.src="//www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}})}),$("*[data-song-vid]").each(function(){var a=$(this),b=(a.attr("id"),a.attr("data-song-vid"));a.append('<iframe id="songplayer_youtube_api" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="//www.youtube.com/embed/'+b+"?enablejsapi=1&amp;iv_load_policy=3&amp;playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;autoplay=0&amp;loop=0&amp;origin="+window.location.origin+'"></iframe>');var c=document.createElement("script");c.src="//www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}),tmt.onPlayerStateChange=function(a){var b=$(".streamer .play"),c=this;1===a.data?(b.removeClass("fa-play"),b.addClass("fa-pause"),tmt.playerIsPlaying=!0,tmt.playerTick(c)):2===a.data&&(b.removeClass("fa-pause"),b.addClass("fa-play"),tmt.playerIsPlaying=!1)},tmt.onPlayerReady=function(){var a=this,b=$(".streamer"),c=b.find(".play");b.find(".duration").html(a.getDuration()),b.find(".progress").click(function(b){if(tmt.playerIsPlaying){var c=$(this).offset(),d=b.pageX-c.left,e=d/$(".streamer .progress").width();a.seekTo(e*a.getDuration(),!0)}}),c.removeClass("fa-stop"),c.addClass("fa-play"),c.click(function(){tmt.playingRange=null,1!=a.getPlayerState()?a.playVideo():a.pauseVideo()}),$("*[data-from]").click(function(){var b=$(this);tmt.playingRange=[parseInt(b.attr("data-from"),10),parseInt(b.attr("data-to"),10)],1!=a.getPlayerState()?a.playVideo():a.pauseVideo(),a.seekTo(tmt.playingRange[0],!0)})},tmt.playerTick=function(a){var b=a.getCurrentTime(),c=a.getDuration(),d=b/c*100;$(".streamer .position").html(parseInt(b,10)),$(".streamer .cursor").css("left",d+"%"),$(".streamer .progress .loaded-bar").css("width",100*a.getVideoLoadedFraction()+"%"),$(".streamer .progress .playing-bar").css("width",d+"%"),tmt.playerIsPlaying&&(tmt.playingRange&&(b>=tmt.playingRange[1]?(tmt.playingRange=null,a.pauseVideo()):b<=tmt.playingRange[0]&&a.seekTo(tmt.playingRange[0],!0)),setTimeout(function(){tmt.playerTick(a)},200))},$("*[data-bug-type]").each(function(){$(this).click(function(){var a=$(this),b=a.attr("data-bug-type"),c=a.attr("data-location"),d=a.attr("data-user");$("body").addClass("dialog-open"),$("#bugreport").length>0?($("#bugreport .modal-content").html('<div class="loading-wrap"><i class="fa fa-refresh fa-spin fa-fw"></i></div>'),$("#bugreport").modal("show")):$('<div id="bugreport" class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="loading-wrap"><i class="fa fa-refresh fa-spin fa-fw"></i></div></div></div></div>').modal().on("hidden.bs.modal",function(){$("body").removeClass("dialog-open")}),$.post("/ajax/bugreport/",{type:b,location:c,user_id:d},function(a){var b=$("#bugreport .modal-content");b.html(a),b.find(".btn-default").click(function(){var a=parseInt(b.find("input[name=id]").val(),10),c=b.find("textarea").val().trim();c.length>0&&$.post("/ajax/bugreport/",{id:a,details:c})})})})}),tmt.pieGraph=function(a,b){$(".piechart."+a).each(function(){f($(this).append("<canvas>"),b)})},tmt.lineGraph=function(a,b){$(".timeline ."+a+" canvas.graph").each(function(){g($(this),b)})},tmt.rangeGraph=function(a,b){$(".timeline ."+a+" canvas.graph").each(function(){i($(this),b)})},tmt.waveform=function(a,b){$(".timeline ."+a+" canvas.graph").each(function(){h($(this),b)})}});