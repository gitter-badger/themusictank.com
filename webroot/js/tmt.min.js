function onYouTubePlayerAPIReady(){var a=new YT.Player("songplayer_youtube_api");a.addEventListener("onReady",tmt.onPlayerReady.bind(a)),a.addEventListener("onStateChange",tmt.onPlayerStateChange.bind(a))}var tmt=window.tmt||{};$(function(){function a(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function b(){if(k.window.scrollTop()>70?(k[".navbar"].addClass("opaque"),k[".breadcrumbs"].addClass("opaque")):(k[".navbar"].removeClass("opaque"),k[".breadcrumbs"].removeClass("opaque")),k[".header-wrapper"].length){var a=k.window.height(),b=k.window.width(),c=k[".header-wrapper"].innerWidth()/k[".header-wrapper"].innerHeight();scrollTop=k.window.scrollTop(),scrolledDistance=scrollTop/5,wrapHeight=k[".header-wrapper"].innerHeight(),imgHeight=k[".header-wrapper img.clean"].height(),opacityVal=1-scrollTop/150,threshold=5,c>b/a?k[".header-wrapper"].hasClass("vertical")||k[".header-wrapper"].addClass("vertical"):k[".header-wrapper"].hasClass("vertical")&&k[".header-wrapper"].removeClass("vertical"),scrolledDistance>threshold&&wrapHeight>scrolledDistance?(k[".header-wrapper img.clean"].css("opacity",opacityVal),k[".header-wrapper .mask"].css("background-position-y",-(.3*scrolledDistance)+"px"),imgHeight-wrapHeight>scrolledDistance&&k[".header-wrapper img"].css("top",-scrolledDistance+"px")):threshold>=scrolledDistance&&(k[".header-wrapper .mask"].css("background-position-y","0px"),k[".header-wrapper img"].css("top","0px"),k[".header-wrapper img.clean"].css("opacity",1))}}function c(a){var b=$(this);a.preventDefault(),$.ajax(b.attr("href")).done(function(a){var d=b.parent();d.html(a),d.find("a.follow, a.unfollow").on("click",c)})}function d(){return $.ajax({dataType:"html",url:"/ajax/okstfu/",success:function(a){p.html(a)}}),!1}function e(){$.ajax({dataType:"html",url:"/ajax/whatsup/",success:function(a){p.html(a),$(".notifier li.mark a").click(d),setTimeout(e,9e4)}})}function f(a){new Date(1e3*a)}function g(a,b){var c=a.find("canvas").get(0),d=c.getContext("2d"),e=a.height(),f=a.width();c.width=f,c.height=e,d.beginPath(),d.arc(e/2,f/2,f,0,2*Math.PI,!1),d.fillStyle="#000000",d.fill();var g=0;b.liking_pct>0&&(d.beginPath(),d.arc(e/2,f/2,f,0,360*b.liking_pct,!1),d.fillStyle="green",d.fill(),g=360*b.liking_pct),b.disliking_pct>0&&(d.beginPath(),d.arc(e/2,f/2,f,g,360*b.disliking_pct,!1),d.fillStyle="red",d.fill())}function h(a,b){var c=a.get(0),d=c.getContext("2d"),e=a.height(),f=a.width();c.width=f,c.height=e,d.beginPath(),d.moveTo(0,e/2);for(var g=0,h=b.length;h>g;g++);d.lineTo(f,e/2),d.strokeStyle="#333",d.strokeWidth="1.2",d.stroke()}function i(a,b){var c=a.get(0),d=c.getContext("2d"),e=a.height(),f=e/2,g=a.width();c.width=g,c.height=e;for(var h,i,j=0,k=b.length,l=g/k;k>j;j++)h=Math.abs(128-b[j]),i=100*h/128*f,d.beginPath(),d.rect(j*l,i-f,l,f+i),d.fillStyle="rgba(0,0,0.4)",d.fill()}function j(){}var k={window:$(window),".navbar":$(".navbar"),".breadcrumbs":$(".breadcrumbs"),".header-wrapper":$(".header-wrapper"),".header-wrapper .mask":$(".header-wrapper .mask"),".header-wrapper img":$(".header-wrapper img"),".header-wrapper img.clean":$(".header-wrapper img.clean")};k.window.scroll(a(b,60)),$("a.follow, a.unfollow").on("click",c);var l=new Bloodhound({name:"artists",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.artist)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/artistssearch/?q=%QUERY"}),m=new Bloodhound({name:"albums",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.album)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/albumssearch/?q=%QUERY"}),n=new Bloodhound({name:"tracks",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.track)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/trackssearch/?q=%QUERY"});l.initialize(),m.initialize(),n.initialize();var o=$(".typeahead");o.on("typeahead:selected",function(a,b,c){document.location="/"+[c,"view",b.slug].join("/"),a.preventDefault()}),o.typeahead({minLength:3,highlight:!0,cache:!0},[{name:"artists",displayKey:"artist",source:l.ttAdapter(),cache:!0,templates:{header:"<h3>Artists</h3>",suggestion:function(a){return["<p>",a.artist,"</p>"].join("")}}},{name:"albums",displayKey:"album",source:m.ttAdapter(),cache:!0,templates:{header:"<h3>Albums</h3>",suggestion:function(a){return["<p>",a.album," by ",a.artist,"</p>"].join("")}}},{name:"tracks",displayKey:"track",source:n.ttAdapter(),cache:!0,templates:{header:"<h3>Tracks</h3>",suggestion:function(a){return["<p>",a.track," from ",a.album,"</p>"].join("")}}}]);var p=$(".notifier");p.length>0&&setTimeout(e,300);var p=$("#mapCanvas");if(p.length>0){var q={center:new google.maps.LatLng(45.4516675,-73.5904749),zoom:8,disableDefaultUI:!0,draggable:!1,disableDoubleClickZoom:!1,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"water",elementType:"geometry",stylers:[{color:"#193341"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#2c5a71"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#29768a"},{lightness:-37}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#406d80"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#406d80"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#3e606f"},{weight:2},{gamma:.84}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"administrative",elementType:"geometry",stylers:[{weight:.6},{color:"#1a3541"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#2c5a71"}]}]};new google.maps.Map(p.get(0),q)}$("*[data-post-load]").each(function(){var a=$(this);a.load(a.attr("data-post-load"))}),$("*[data-song]").each(function(){var a=$(this),b=(a.attr("id"),a.attr("data-song"));$.getJSON("/ajax/getsong/"+b,function(b){if(11===b.vid.length){videoId=b.vid,a.append('<iframe id="songplayer_youtube_api" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="//www.youtube.com/embed/'+videoId+"?enablejsapi=1&amp;iv_load_policy=3&amp;playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;autoplay=0&amp;loop=0&amp;origin="+window.location.origin+'"></iframe>');var c=document.createElement("script");c.src="//www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}})}),$("*[data-song-vid]").each(function(){var a=$(this),b=(a.attr("id"),a.attr("data-song-vid"));a.append('<iframe id="songplayer_youtube_api" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="//www.youtube.com/embed/'+b+"?enablejsapi=1&amp;iv_load_policy=3&amp;playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;autoplay=0&amp;loop=0&amp;origin="+window.location.origin+'"></iframe>');var c=document.createElement("script");c.src="//www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}),tmt.onPlayerStateChange=function(a){var b=$(".streamer .play"),c=this;1===a.data?(b.removeClass("fa-play"),b.addClass("fa-pause"),tmt.playerIsPlaying=!0,tmt.playerTick(c)):2===a.data&&(b.removeClass("fa-pause"),b.addClass("fa-play"),tmt.playerIsPlaying=!1)},tmt.onPlayerReady=function(){var a=this,b=$(".streamer"),c=b.find(".play");b.find(".duration").html(f(a.getDuration())),b.find(".progress-wrap .progress").click(function(b){if(tmt.playerIsPlaying){var c=$(this).offset(),d=b.pageX-c.left,e=d/$(".streamer .progress-wrap .progress").width();a.seekTo(e*a.getDuration(),!0)}}),c.removeClass("fa-stop"),c.addClass("fa-play"),c.click(function(){tmt.playingRange=null,1!=a.getPlayerState()?a.playVideo():a.pauseVideo()}),$("*[data-from]").click(function(){var b=$(this);tmt.playingRange=[parseInt(b.attr("data-from"),10),parseInt(b.attr("data-to"),10)],1!=a.getPlayerState()?a.playVideo():a.pauseVideo(),a.seekTo(tmt.playingRange[0],!0)})},tmt.playerTick=function(a){var b=a.getCurrentTime(),c=a.getDuration(),d=b/c*100;$(".streamer .position").html(f(b)),$(".streamer .cursor").css("left",d+"%"),$(".streamer .progress .loaded-bar").css("width",100*a.getVideoLoadedFraction()+"%"),$(".streamer .progress .playing-bar").css("width",d+"%"),$(".streamer .progress .playing-bar").attr("aria-valuenow",b),tmt.playerIsPlaying&&(tmt.playingRange&&(b>=tmt.playingRange[1]?(tmt.playingRange=null,a.pauseVideo()):b<=tmt.playingRange[0]&&a.seekTo(tmt.playingRange[0],!0)),setTimeout(function(){tmt.playerTick(a)},200))},$("*[data-bug-type]").each(function(){$(this).click(function(){var a=$(this),b=a.attr("data-bug-type"),c=a.attr("data-location"),d=a.attr("data-user");$("body").addClass("dialog-open"),$("#bugreport").length>0?($("#bugreport .modal-content").html('<div class="loading-wrap"><i class="fa fa-refresh fa-spin fa-fw"></i></div>'),$("#bugreport").modal("show")):$('<div id="bugreport" class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="loading-wrap"><i class="fa fa-refresh fa-spin fa-fw"></i></div></div></div></div>').modal().on("hidden.bs.modal",function(){$("body").removeClass("dialog-open")}),$.post("/ajax/bugreport/",{type:b,location:c,user_id:d},function(a){var b=$("#bugreport .modal-content");b.html(a),b.find(".btn-default").click(function(){var a=parseInt(b.find("input[name=id]").val(),10),c=b.find("textarea").val().trim();c.length>0&&$.post("/ajax/bugreport/",{id:a,details:c})})})})}),tmt.pieGraph=function(a,b){b&&$(".piechart."+a).each(function(){g($(this).append("<canvas>"),b)})},tmt.lineGraph=function(a,b){b&&$(".timeline ."+a+" canvas.graph").each(function(){h($(this),b)})},tmt.rangeGraph=function(a,b){b&&$(".timeline ."+a+" canvas.graph").each(function(){j($(this),b)})},tmt.waveform=function(a,b){b&&$(".timeline ."+a+" canvas.graph").each(function(){i($(this),b)})}});