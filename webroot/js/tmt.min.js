function onYouTubePlayerAPIReady(){var a=new YT.Player("songplayer_youtube_api");a.addEventListener("onReady",tmt.onPlayerReady.bind(a)),a.addEventListener("onStateChange",tmt.onPlayerStateChange.bind(a))}var tmt=window.tmt||{};$(function(){function a(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function b(){if(f.window.scrollTop()>70?(f[".navbar"].addClass("opaque"),f[".breadcrumbs"].addClass("opaque")):(f[".navbar"].removeClass("opaque"),f[".breadcrumbs"].removeClass("opaque")),f[".header-wrapper"].length){var a=f.window.height(),b=f.window.width(),c=f[".header-wrapper"].innerWidth()/f[".header-wrapper"].innerHeight();scrollTop=f.window.scrollTop(),scrolledDistance=scrollTop/5,wrapHeight=f[".header-wrapper"].innerHeight(),imgHeight=f[".header-wrapper img.clean"].height(),opacityVal=1-scrollTop/150,threshold=5,c>b/a?f[".header-wrapper"].hasClass("vertical")||f[".header-wrapper"].addClass("vertical"):f[".header-wrapper"].hasClass("vertical")&&f[".header-wrapper"].removeClass("vertical"),scrolledDistance>threshold&&wrapHeight>scrolledDistance?(f[".header-wrapper img.clean"].css("opacity",opacityVal),f[".header-wrapper .mask"].css("background-position-y",-(.3*scrolledDistance)+"px"),imgHeight-wrapHeight>scrolledDistance&&f[".header-wrapper img"].css("top",-scrolledDistance+"px")):threshold>=scrolledDistance&&(f[".header-wrapper .mask"].css("background-position-y","0px"),f[".header-wrapper img"].css("top","0px"),f[".header-wrapper img.clean"].css("opacity",1))}}function c(a){var b=$(this);a.preventDefault(),$.ajax(b.attr("href")).done(function(a){var d=b.parent();d.html(a),d.find("a.follow, a.unfollow").on("click",c)})}function d(){return $.ajax({dataType:"html",url:"/ajax/okstfu/",success:function(a){k.html(a)}}),!1}function e(){$.ajax({dataType:"html",url:"/ajax/whatsup/",success:function(a){k.html(a),$(".notifier li.mark a").click(d),setTimeout(e,9e4)}})}var f={window:$(window),".navbar":$(".navbar"),".breadcrumbs":$(".breadcrumbs"),".header-wrapper":$(".header-wrapper"),".header-wrapper .mask":$(".header-wrapper .mask"),".header-wrapper img":$(".header-wrapper img"),".header-wrapper img.clean":$(".header-wrapper img.clean")};f.window.scroll(a(b,60)),$("a.follow, a.unfollow").on("click",c);var g=new Bloodhound({name:"artists",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.artist)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/artistssearch/?q=%QUERY"}),h=new Bloodhound({name:"albums",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.album)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/albumssearch/?q=%QUERY"}),i=new Bloodhound({name:"tracks",datumTokenizer:function(a){return Bloodhound.tokenizers.obj.whitespace(a.track)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:"/ajax/trackssearch/?q=%QUERY"});g.initialize(),h.initialize(),i.initialize();var j=$(".typeahead");j.on("typeahead:selected",function(a,b,c){document.location="/"+[c,"view",b.slug].join("/"),a.preventDefault()}),j.typeahead({minLength:3,highlight:!0,cache:!0},[{name:"artists",displayKey:"artist",source:g.ttAdapter(),cache:!0,templates:{header:"<h3>Artists</h3>",suggestion:function(a){return["<p>",a.artist,"</p>"].join("")}}},{name:"albums",displayKey:"album",source:h.ttAdapter(),cache:!0,templates:{header:"<h3>Albums</h3>",suggestion:function(a){return["<p>",a.album," by ",a.artist,"</p>"].join("")}}},{name:"tracks",displayKey:"track",source:i.ttAdapter(),cache:!0,templates:{header:"<h3>Tracks</h3>",suggestion:function(a){return["<p>",a.track," from ",a.album,"</p>"].join("")}}}]);var k=$(".notifier");k.length>0&&setTimeout(e,300);var k=$("#mapCanvas");if(k.length>0){var l={center:new google.maps.LatLng(45.4516675,-73.5904749),zoom:8,disableDefaultUI:!0,draggable:!1,disableDoubleClickZoom:!1,scrollwheel:!1,mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"water",elementType:"geometry",stylers:[{color:"#193341"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#2c5a71"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#29768a"},{lightness:-37}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#406d80"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#406d80"}]},{elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#3e606f"},{weight:2},{gamma:.84}]},{elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"administrative",elementType:"geometry",stylers:[{weight:.6},{color:"#1a3541"}]},{elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#2c5a71"}]}]};new google.maps.Map(k.get(0),l)}$("*[data-post-load]").each(function(){var a=$(this);a.load(a.attr("data-post-load"))}),$("*[data-song]").each(function(){var a=$(this),b=(a.attr("id"),a.attr("data-song"));$.getJSON("/ajax/getsong/"+b,function(b){if(11===b.vid.length){videoId=b.vid,a.append('<iframe id="songplayer_youtube_api" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="//www.youtube.com/embed/'+videoId+"?enablejsapi=1&amp;iv_load_policy=3&amp;playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;autoplay=0&amp;loop=0&amp;origin="+window.location.origin+'"></iframe>');var c=document.createElement("script");c.src="//www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}})}),$("*[data-song-vid]").each(function(){var a=$(this),b=(a.attr("id"),a.attr("data-song-vid"));a.append('<iframe id="songplayer_youtube_api" scrolling="no" marginwidth="0" marginheight="0" frameborder="0" src="//www.youtube.com/embed/'+b+"?enablejsapi=1&amp;iv_load_policy=3&amp;playerapiid=songplayer_component_17&amp;disablekb=1&amp;wmode=transparent&amp;controls=0&amp;playsinline=0&amp;showinfo=0&amp;modestbranding=1&amp;rel=0&amp;autoplay=0&amp;loop=0&amp;origin="+window.location.origin+'"></iframe>');var c=document.createElement("script");c.src="//www.youtube.com/player_api";var d=document.getElementsByTagName("script")[0];d.parentNode.insertBefore(c,d)}),tmt.onPlayerStateChange=function(a){var b=$(".streamer .play"),c=this;1===a.data?(b.removeClass("fa-play"),b.addClass("fa-pause"),tmt.playerIsPlaying=!0,tmt.playerTick(c)):2===a.data&&(b.removeClass("fa-pause"),b.addClass("fa-play"),tmt.playerIsPlaying=!1)},tmt.onPlayerReady=function(){var a=this,b=$(".streamer"),c=b.find(".play");b.find(".duration").html(a.getDuration()),b.find(".progress").click(function(b){if(tmt.playerIsPlaying){var c=$(this).offset(),d=b.pageX-c.left,e=d/$(".streamer .progress").width();a.seekTo(e*a.getDuration(),!0)}}),c.removeClass("fa-stop"),c.addClass("fa-play"),c.click(function(){tmt.playingRange=null,1!=a.getPlayerState()?a.playVideo():a.pauseVideo()}),$("*[data-from]").click(function(){var b=$(this);tmt.playingRange=[parseInt(b.attr("data-from"),10),parseInt(b.attr("data-to"),10)],1!=a.getPlayerState()?a.playVideo():a.pauseVideo(),a.seekTo(tmt.playingRange[0],!0)})},tmt.playerTick=function(a){var b=a.getCurrentTime(),c=a.getDuration(),d=b/c*100;$(".streamer .position").html(parseInt(b,10)),$(".streamer .cursor").css("left",d+"%"),$(".streamer .progress .loaded-bar").css("width",100*a.getVideoLoadedFraction()+"%"),$(".streamer .progress .playing-bar").css("width",d+"%"),tmt.playerIsPlaying&&(tmt.playingRange&&(b>=tmt.playingRange[1]?(tmt.playingRange=null,a.pauseVideo()):b<=tmt.playingRange[0]&&a.seekTo(tmt.playingRange[0],!0)),setTimeout(function(){tmt.playerTick(a)},200))},$("*[data-bug-type]").each(function(){$(this).click(function(){var a=$(this),b=a.attr("data-bug-type"),c=a.attr("data-location"),d=a.attr("data-user");$("body").addClass("dialog-open"),$("#bugreport").length>0?($("#bugreport .modal-content").html('<div class="loading-wrap"><i class="fa fa-refresh fa-spin fa-fw"></i></div>'),$("#bugreport").modal("show")):$('<div id="bugreport" class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="loading-wrap"><i class="fa fa-refresh fa-spin fa-fw"></i></div></div></div></div>').modal().on("hidden.bs.modal",function(){$("body").removeClass("dialog-open")}),$.post("/ajax/bugreport/",{type:b,location:c,user_id:d},function(a){var b=$("#bugreport .modal-content");b.html(a),b.find(".btn-default").click(function(){var a=parseInt(b.find("input[name=id]").val(),10),c=b.find("textarea").val().trim();c.length>0&&$.post("/ajax/bugreport/",{id:a,details:c})})})})}),tmt.waveform=function(a,b){if(b&&b.length>0)for(var c={top:20,right:20,bottom:30,left:40},d=a[0][0].offsetWidth-c.left-c.right,e=a[0][0].offsetHeight-c.top-c.bottom,f=d/b.length,g=0,h=b.length;h>g;g++)a.append("line").attr("x1",f*g).attr("y1",e*b[g][0]/100).attr("x2",f*g).attr("y2",e*b[g][1]/100)},tmt.createPie=function(a,b){var c=200,d=200,e=100,f=d3.scale.category20c();if(data=b,0!==b.length){var g=d3.select(a).append("svg:svg").data([data]).attr("width",c).attr("height",d).append("svg:g").attr("transform","translate("+e+","+e+")"),h=d3.svg.arc().outerRadius(e),i=d3.layout.pie().value(function(a){return a.value}),j=g.selectAll("g.slice").data(i).enter().append("svg:g").attr("class","slice");j.append("svg:path").attr("fill",function(a,b){return f(b)}).attr("d",h),j.append("svg:text").attr("transform",function(a){return a.innerRadius=0,a.outerRadius=e,"translate("+h.centroid(a)+")"}).attr("text-anchor","middle").text(function(a,b){return data[b].type})}},tmt.createLine=function(a,b,c){var d={top:20,right:20,bottom:30,left:40},e=a[0][0].offsetWidth-d.left-d.right,f=a[0][0].offsetHeight-d.top-d.bottom;if(0!==b.length){var g=d3.range(c.total).map(function(a){return b[a]?{x:a,y:parseFloat(b[a].avg)}:{x:a,y:.5}}),h=d3.scale.linear().domain([0,g[g.length-1].x]).range([0,e]),i=d3.scale.linear().domain([0,1]).range([f,0]),j=d3.svg.line().defined(function(a){return null!=a.y}).x(function(a){return h(a.x)}).y(function(a){return i(a.y)});a.append("path").attr("class","line "+c.key).attr("d",j),a.selectAll(".dot").data(g.filter(function(a){return a.y})).enter().append("circle").attr("class","dot "+c.key).attr("cx",j.x()).attr("cy",j.y()).attr("r",3.5)}},tmt.createRange=function(a,b,c){if(0!==b.length){var d=d3.range(c.total).map(function(a){return b[a]?{x:a,y:parseFloat(b[a].min),x1:a,y1:parseFloat(b[a].max)}:{x:a,y:.5,x1:a,y1:.5}}),e={top:20,right:20,bottom:30,left:40},f=a[0][0].offsetWidth-e.left-e.right,g=a[0][0].offsetHeight-e.top-e.bottom,h=(d3.format(",.0f"),d3.time.format("%H:%M")),i=function(a){return h(new Date(2012,0,1,0,a))},j=d3.scale.linear().domain([0,d[d.length-1].x]).range([0,f]),k=d3.scale.linear().domain([0,1]).range([g,0]),l=d3.svg.axis().scale(j).orient("bottom").tickFormat(i),m=d3.svg.axis().scale(k).orient("left"),n=d3.svg.line().defined(function(a){return null!=a.y}).x(function(a){return j(a.x)}).y(function(a){return k(a.y)}),o=d3.svg.line().defined(function(a){return null!=a.y1}).x(function(a){return j(a.x1)}).y(function(a){return k(a.y1)}),p=d3.svg.area().defined(n.defined()).x(n.x()).y1(o.y()).y0(n.y());a.datum(d).attr("width",f+e.left+e.right).attr("height",g+e.top+e.bottom).append("g").attr("transform","translate("+e.left+","+e.top+")"),a.append("path").attr("class","area "+c.key).attr("d",p),a.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(l),a.append("g").attr("class","y axis").call(m),a.append("path").attr("class","line").attr("d",n),a.append("path").attr("class","line").attr("d",o)}}});